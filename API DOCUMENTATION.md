# Abr√®ge API ‚Äì Documentation de R√©f√©rence

---

## Table of Contents
- [üìù Notes](#notes)
  - [Cr√©er une note](#cr√©er-une-note)
  - [D√©placer une note](#d√©placer-une-note)
  - [R√©cup√©rer une note](#r√©cup√©rer-une-note)
- [üìÅ Dossiers](#dossiers)
  - [Cr√©er un dossier](#cr√©er-un-dossier)
  - [D√©placer un dossier](#d√©placer-un-dossier)
  - [R√©cup√©rer un dossier](#r√©cup√©rer-un-dossier)
  - [Mettre √† jour un dossier](#mettre-√†-jour-un-dossier)
  - [Supprimer un dossier](#supprimer-un-dossier)
- [üìí Notebooks](#notebooks)
  - [Cr√©er un notebook](#cr√©er-un-notebook)
  - [R√©cup√©rer un notebook](#r√©cup√©rer-un-notebook)
  - [Mettre √† jour un notebook](#mettre-√†-jour-un-notebook)
  - [Supprimer un notebook](#supprimer-un-notebook)
- [üõ†Ô∏è Utilitaires](#utilitaires)
  - [G√©n√©rer un slug](#g√©n√©rer-un-slug)

---

> **Tous les endpoints n√©cessitent un Bearer token (JWT) dans l‚Äôen-t√™te `Authorization`.**
> Toutes les ressources (notes, dossiers, notebooks) peuvent √™tre r√©f√©renc√©es par **slug ou UUID** partout (URL et body).
> Toutes les r√©ponses sont en JSON, avec une propri√©t√© racine claire (`note`, `folder`, `notebook`, etc.).

---

## üìù Notes

---

### Cr√©er une note

**Nom & Description**  
Cr√©er une note dans un notebook (classeur), √©ventuellement dans un dossier.

**M√©thode HTTP** : `POST`

**URL compl√®te** : `/api/v1/note/create`

**Param√®tres** : Aucun

**Corps de la requ√™te (body)** :

| Champ            | Type         | Requis | Description                                         |
|------------------|--------------|--------|-----------------------------------------------------|
| `source_title`   | string       | oui    | Titre de la note                                    |
| `markdown_content`| string      | oui    | Contenu markdown                                    |
| `folder_id`      | string/null  | non    | ID/slug du dossier, ou null/""/"null" pour racine    |
| `notebook_id`    | string       | oui    | ID ou slug du notebook (classeur)                   |

**Exemple de requ√™te JSON** :
```json
{
  "source_title": "My note",
  "markdown_content": "# Hello",
  "folder_id": null,
  "notebook_id": "ai"
}
```

**R√©ponse attendue** :
```json
{
  "note": {
    "id": "123",
    "slug": "my-note",
    "source_title": "My note",
    "markdown_content": "# Hello",
    "folder_id": null,
    "classeur_id": "ai",
    "created_at": "...",
    "updated_at": "..."
  }
}
```

**Codes de r√©ponse HTTP** :
- `201` : Note cr√©√©e avec succ√®s
- `400` : Param√®tre manquant ou invalide
- `401` : Authentification requise
- `422` : Erreur de validation (ex: markdown vide)
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si `notebook_id` absent ou invalide ‚Üí 400/422
> - Si `folder_id` non trouv√© ‚Üí 404
> - Si le Content-Type n‚Äôest pas `application/json`, le backend peut renvoyer une erreur ou du HTML (rare)
> - Si le champ est absent, il n‚Äôest pas modifi√© (jamais racine par d√©faut)

> **Remarques / Conseils d‚Äôint√©gration**
> - Toujours envoyer un `folder_id` explicite pour la racine (`null`, `""` ou `"null"`)
> - Les slugs sont accept√©s partout (plus simple pour les LLM)
> - R√©ponse toujours JSON, jamais HTML sauf bug critique

---

### D√©placer une note

**Nom & Description**  
D√©placer une note dans un autre notebook et/ou dossier, ou √† la racine.

**M√©thode HTTP** : `PATCH`

**URL compl√®te** : `/api/v1/note/{ref}/move`

**Param√®tres** :
| Nom   | Type   | O√π     | Description                  |
|-------|--------|--------|------------------------------|
| `ref` | string | path   | ID ou slug de la note √† d√©placer |

**Corps de la requ√™te (body)** :
| Champ                | Type         | Requis | Description                                         |
|----------------------|--------------|--------|-----------------------------------------------------|
| `target_classeur_id` | string       | non    | ID ou slug du notebook cible                        |
| `target_folder_id`   | string/null  | non    | ID/slug du dossier cible, ou null/""/"null" pour racine |
| `position`           | number       | non    | Position dans le dossier cible                      |

**Exemples de requ√™te JSON** :
- D√©placer dans un dossier :
```json
{
  "target_classeur_id": "ai",
  "target_folder_id": "my-folder"
}
```
- D√©placer √† la racine :
```json
{
  "target_classeur_id": "ai",
  "target_folder_id": null
}
```

**R√©ponse attendue** :
```json
{
  "note": {
    "id": "...",
    "folder_id": null,
    "classeur_id": "ai"
  }
}
```

**Codes de r√©ponse HTTP** :
- `200` : Note d√©plac√©e
- `404` : Note, notebook ou dossier cible non trouv√©
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si `target_folder_id` absent ‚Üí le champ n‚Äôest pas modifi√© (la note reste dans son dossier)
> - Pour la racine, il faut explicitement envoyer `null`, `""` ou `"null"`
> - Si le backend bug, il peut renvoyer du HTML (rare, bug critique)

> **Remarques / Conseils d‚Äôint√©gration**
> - Toujours inclure `target_folder_id` pour la racine
> - Slugs et IDs accept√©s partout
> - R√©ponse toujours JSON

---

### R√©cup√©rer une note

**Nom & Description**  
Retourne les infos d‚Äôune note par ID ou slug.

**M√©thode HTTP** : `GET`

**URL compl√®te** : `/api/v1/note/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug de la note        |

**Corps de la requ√™te (body)** : Aucun

**Exemple de requ√™te JSON** : N/A

**R√©ponse attendue** :
```json
{
  "note": { ... }
}
```

**Codes de r√©ponse HTTP** :
- `200` : OK
- `404` : Note non trouv√©e
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si le ref est invalide, 404 ou 422
> - Si le backend bug, peut renvoyer du HTML

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

### Publier ou d√©publier une note

**Nom & Description**  
Permet d‚Äôactiver ou d√©sactiver la publication publique d‚Äôune note (partage via URL).

**M√©thode HTTP** : `PATCH`

**URL compl√®te** : `/api/v1/note/publish`

**Corps de la requ√™te (body)** :

| Champ         | Type    | Requis | Description                                 |
|--------------|---------|--------|---------------------------------------------|
| `ref`        | string  | oui    | ID ou slug de la note √† publier/d√©publier   |
| `isPublished`| boolean | oui    | true pour publier, false pour d√©publier     |

**R√©ponse (200)** :
```json
{
  "success": true,
  "url": "https://abrege93.vercel.app/@username/shared/note-slug"
}
```
- `url` est pr√©sent uniquement si la note est publi√©e (`isPublished: true`).

**R√©ponse (erreur)** :
```json
{
  "error": "Message d‚Äôerreur explicite."
}
```

---

## üìÅ Dossiers

---

### Cr√©er un dossier

**Nom & Description**  
Cr√©er un dossier dans un notebook (classeur), √©ventuellement dans un dossier parent.

**M√©thode HTTP** : `POST`

**URL compl√®te** : `/api/v1/folder/create`

**Param√®tres** : Aucun

**Corps de la requ√™te (body)** :
| Champ         | Type         | Requis | Description                                         |
|--------------|--------------|--------|-----------------------------------------------------|
| `name`       | string       | oui    | Nom du dossier                                      |
| `notebook_id`| string       | oui    | ID ou slug du notebook (classeur)                   |
| `parent_id`  | string/null  | non    | ID/slug du dossier parent, ou null/""/"null" pour racine |

**Exemple de requ√™te JSON** :
```json
{
  "name": "My folder",
  "notebook_id": "ai",
  "parent_id": null
}
```

**R√©ponse attendue** :
```json
{
  "folder": {
    "id": "...",
    "slug": "my-folder",
    "name": "My folder",
    "parent_id": null,
    "classeur_id": "ai",
    "created_at": "...",
    "updated_at": "..."
  }
}
```

**Codes de r√©ponse HTTP** :
- `201` : Dossier cr√©√©
- `400` : Param√®tre manquant ou invalide
- `401` : Authentification requise
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si `notebook_id` absent ou invalide ‚Üí 400/422
> - Si `parent_id` non trouv√© ‚Üí 404
> - Pour la racine, il faut explicitement envoyer `null`, `""` ou `"null"`

> **Remarques / Conseils d‚Äôint√©gration**
> - Slugs accept√©s partout
> - R√©ponse toujours JSON

---

### D√©placer un dossier

**Nom & Description**  
D√©placer un dossier dans un autre notebook et/ou dossier parent, ou √† la racine.

**M√©thode HTTP** : `PATCH`

**URL compl√®te** : `/api/v1/dossier/{ref}/move`

**Param√®tres** :
| Nom   | Type   | O√π     | Description                  |
|-------|--------|--------|------------------------------|
| `ref` | string | path   | ID ou slug du dossier √† d√©placer |

**Corps de la requ√™te (body)** :
| Champ                | Type         | Requis | Description                                         |
|----------------------|--------------|--------|-----------------------------------------------------|
| `target_classeur_id` | string       | non    | ID ou slug du notebook cible                        |
| `target_parent_id`   | string/null  | non    | ID/slug du dossier parent, ou null/""/"null" pour racine |
| `position`           | number       | non    | Position dans le dossier parent                     |

**Exemples de requ√™te JSON** :
- D√©placer dans un dossier parent :
```json
{
  "target_classeur_id": "ai",
  "target_parent_id": "parent-folder"
}
```
- D√©placer √† la racine :
```json
{
  "target_classeur_id": "ai",
  "target_parent_id": null
}
```

**R√©ponse attendue** :
```json
{
  "folder": {
    "id": "...",
    "parent_id": null,
    "classeur_id": "ai"
  }
}
```

**Codes de r√©ponse HTTP** :
- `200` : Dossier d√©plac√©
- `404` : Dossier, notebook ou parent cible non trouv√©
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si `target_parent_id` absent ‚Üí le champ n‚Äôest pas modifi√© (le dossier reste dans son parent)
> - Pour la racine, il faut explicitement envoyer `null`, `""` ou `"null"`

> **Remarques / Conseils d‚Äôint√©gration**
> - Toujours inclure `target_parent_id` pour la racine
> - Slugs et IDs accept√©s partout
> - R√©ponse toujours JSON

---

### R√©cup√©rer un dossier

**Nom & Description**  
Retourne les infos d‚Äôun dossier par ID ou slug.

**M√©thode HTTP** : `GET`

**URL compl√®te** : `/api/v1/folder/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du dossier        |

**Corps de la requ√™te (body)** : Aucun

**Exemple de requ√™te JSON** : N/A

**R√©ponse attendue** :
```json
{
  "folder": { ... }
}
```

**Codes de r√©ponse HTTP** :
- `200` : OK
- `404` : Dossier non trouv√©
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si le ref est invalide, 404 ou 422

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

### Mettre √† jour un dossier

**Nom & Description**  
Met √† jour le nom d‚Äôun dossier.

**M√©thode HTTP** : `PUT`

**URL compl√®te** : `/api/v1/folder/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du dossier        |

**Corps de la requ√™te (body)** :
| Champ | Type   | Requis | Description |
|-------|--------|--------|-------------|
| `name`| string | oui    | Nouveau nom |

**Exemple de requ√™te JSON** :
```json
{
  "name": "Updated folder"
}
```

**R√©ponse attendue** :
```json
{
  "folder": { ... }
}
```

**Codes de r√©ponse HTTP** :
- `200` : Dossier mis √† jour
- `404` : Dossier non trouv√©
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

### Supprimer un dossier

**Nom & Description**  
Supprime un dossier par ID ou slug.

**M√©thode HTTP** : `DELETE`

**URL compl√®te** : `/api/v1/folder/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du dossier        |

**Corps de la requ√™te (body)** : Aucun

**Exemple de requ√™te JSON** : N/A

**R√©ponse attendue** :
```json
{
  "success": true
}
```

**Codes de r√©ponse HTTP** :
- `200` : Dossier supprim√©
- `404` : Dossier non trouv√©
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

## üìí Notebooks

---

### Cr√©er un notebook

**Nom & Description**  
Cr√©er un nouveau notebook (classeur).

**M√©thode HTTP** : `POST`

**URL compl√®te** : `/api/v1/notebook/create`

**Param√®tres** : Aucun

**Corps de la requ√™te (body)** :
| Champ   | Type   | Requis | Description |
|---------|--------|--------|-------------|
| `name`  | string | oui    | Nom du notebook |
| `emoji` | string | oui    | Emoji unicode (ex: "üìí") |

**Exemple de requ√™te JSON** :
```json
{
  "name": "My notebook",
  "emoji": "üìí"
}
```

**R√©ponse attendue** :
```json
{
  "notebook": {
    "id": "...",
    "slug": "my-notebook",
    "name": "My notebook",
    "emoji": "üìí",
    "created_at": "...",
    "updated_at": "..."
  }
}
```

**Codes de r√©ponse HTTP** :
- `201` : Notebook cr√©√©
- `400` : Param√®tre manquant ou invalide
- `401` : Authentification requise
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - L'emoji est un caract√®re unicode (ex: "üìí"), pas un nom d'ic√¥ne React.
> - Le champ `color` n'est plus utilis√©.
> - Slug g√©n√©r√© automatiquement
> - R√©ponse toujours JSON

---

### R√©cup√©rer un notebook

**Nom & Description**  
Retourne les infos d‚Äôun notebook par ID ou slug.

**M√©thode HTTP** : `GET`

**URL compl√®te** : `/api/v1/notebook/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du notebook       |

**Corps de la requ√™te (body)** : Aucun

**Exemple de requ√™te JSON** : N/A

**R√©ponse attendue** :
```json
{
  "notebook": { ... }
}
```

**Codes de r√©ponse HTTP** :
- `200` : OK
- `404` : Notebook non trouv√©
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

### Mettre √† jour un notebook

**Nom & Description**  
Met √† jour le nom, l‚Äôemoji ou la couleur d‚Äôun notebook.

**M√©thode HTTP** : `PUT`

**URL compl√®te** : `/api/v1/notebook/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du notebook       |

**Corps de la requ√™te (body)** :
| Champ   | Type   | Requis | Description |
|---------|--------|--------|-------------|
| `name`  | string | non    | Nouveau nom |
| `emoji` | string | non    | Nouvel emoji |
| `color` | string | non    | Nouvelle couleur hex |

**Exemple de requ√™te JSON** :
```json
{
  "name": "Updated name",
  "emoji": "üß†",
  "color": "#ffcc00"
}
```

**R√©ponse attendue** :
```json
{
  "notebook": { ... }
}
```

**Codes de r√©ponse HTTP** :
- `200` : Notebook mis √† jour
- `404` : Notebook non trouv√©
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

### Supprimer un notebook

**Nom & Description**  
Supprime un notebook par ID ou slug.

**M√©thode HTTP** : `DELETE`

**URL compl√®te** : `/api/v1/notebook/{ref}`

**Param√®tres** :
| Nom   | Type   | O√π   | Description                  |
|-------|--------|------|------------------------------|
| `ref` | string | path | ID ou slug du notebook       |

**Corps de la requ√™te (body)** : Aucun

**Exemple de requ√™te JSON** : N/A

**R√©ponse attendue** :
```json
{
  "success": true
}
```

**Codes de r√©ponse HTTP** :
- `200` : Notebook supprim√©
- `404` : Notebook non trouv√©
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Slug ou ID accept√©
> - R√©ponse toujours JSON

---

## üõ†Ô∏è Utilitaires

---

### G√©n√©rer un slug

**Nom & Description**  
G√©n√®re un slug unique pour une note, un dossier ou un notebook.

**M√©thode HTTP** : `POST`

**URL compl√®te** : `/api/v1/slug/generate`

**Param√®tres** : Aucun

**Corps de la requ√™te (body)** :
| Champ   | Type   | Requis | Description |
|---------|--------|--------|-------------|
| `title` | string | oui    | Titre √† slugifier |
| `type`  | string | oui    | "note", "folder" ou "notebook" |
| `userId`| string | oui    | ID utilisateur |

**Exemple de requ√™te JSON** :
```json
{
  "title": "My note",
  "type": "note",
  "userId": "..."
}
```

**R√©ponse attendue** :
```json
{
  "slug": "my-note"
}
```

**Codes de r√©ponse HTTP** :
- `200` : Slug g√©n√©r√©
- `400` : Param√®tre manquant ou invalide
- `422` : Erreur de validation
- `500` : Erreur serveur

> **Remarques / Conseils d‚Äôint√©gration**
> - Le slug est unique par utilisateur/type
> - R√©ponse toujours JSON 

---

### Fusionner des notes

**Nom & Description**  
Fusionne plusieurs notes en une seule, soit en pr√©visualisation (sans cr√©ation), soit en cr√©ant une nouvelle note fusionn√©e dans un notebook/dossier cible.

**M√©thode HTTP** : `POST`

**URL compl√®te** : `/api/v1/note/merge`

**Param√®tres** : Aucun

**Corps de la requ√™te (body)** :
| Champ         | Type           | Requis | Description                                                                 |
|---------------|----------------|--------|-----------------------------------------------------------------------------|
| `note_ids`    | string[]       | oui    | Tableau d'IDs/slugs de notes √† fusionner (au moins 2)                       |
| `order`       | string[]       | non    | Ordre d'assemblage (m√™mes valeurs que note_ids, optionnel)                  |
| `create_new`  | boolean        | non    | Si true, cr√©e une nouvelle note fusionn√©e (sinon, preview uniquement)       |
| `title`       | string         | non    | Titre de la note fusionn√©e (d√©faut : "Fusion de X notes")                  |
| `classeur_id` | string         | oui*   | ID/slug du notebook cible (obligatoire si create_new: true)                 |
| `notebook_id` | string         | oui*   | Alias LLM-friendly pour classeur_id (slug ou id, prioritaire sur classeur_id)|
| `folder_id`   | string         | non    | ID/slug du dossier cible (optionnel)                                        |

> *Obligatoire si `create_new: true` (sinon ignor√©)

**Exemples de requ√™te JSON** :
- **Pr√©visualisation (fusion temporaire, pas de cr√©ation)**
```json
{
  "note_ids": ["id1", "id2"],
  "order": ["id2", "id1"]
}
```
- **Cr√©ation d'une note fusionn√©e**
```json
{
  "note_ids": ["id1", "id2"],
  "notebook_id": "demo",
  "title": "Fusion finale",
  "create_new": true
}
```

**R√©ponses attendues** :
- **Pr√©visualisation (pas de cr√©ation)**
```json
{
  "merged_content": "Contenu markdown fusionn√©...",
  "notes": [
    { "id": "id1", "title": "Note 1" },
    { "id": "id2", "title": "Note 2" }
  ]
}
```
- **Cr√©ation r√©elle**
```json
{
  "created_note": {
    "id": "...",
    "source_title": "Fusion finale",
    "markdown_content": "Contenu markdown fusionn√©...",
    "folder_id": null,
    "classeur_id": "demo",
    "created_at": "..."
  },
  "merged_from": [
    { "id": "id1", "title": "Note 1" },
    { "id": "id2", "title": "Note 2" }
  ]
}
```

**Codes de r√©ponse HTTP** :
- `200` : Fusion temporaire r√©ussie (pas de cr√©ation)
- `201` : Note fusionn√©e cr√©√©e
- `404` : Une des notes source est introuvable
- `422` : Payload invalide, ou notebook/classeur_id absent si create_new
- `500` : Erreur serveur

> **Erreurs connues / pi√®ges**
> - Si `create_new: true` sans notebook/classeur_id ‚Üí 422
> - Si une note source est introuvable ‚Üí 404
> - Si le Content-Type n‚Äôest pas `application/json`, le backend peut renvoyer une erreur ou du HTML (rare)

> **Remarques / Conseils d‚Äôint√©gration**
> - Utilise `create_new: true` pour cr√©er la note fusionn√©e, sinon tu n‚Äôauras qu‚Äôun aper√ßu temporaire.
> - Tu peux passer des slugs ou des IDs pour toutes les r√©f√©rences (notes, notebook, dossier).
> - Le champ `order` permet de choisir l‚Äôordre d‚Äôassemblage (sinon, l‚Äôordre de note_ids est utilis√©).
> - La note fusionn√©e sera visible dans le notebook/dossier cible si et seulement si `create_new: true`.
> - R√©ponse toujours JSON, jamais HTML sauf bug critique. 