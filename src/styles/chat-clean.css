/* ========================================
   CHAT STYLES - VERSION PROPRE ET MINIMALE
   ========================================
   Fichier unique remplaçant tous les fichiers chat-*.css
   Contient UNIQUEMENT les styles utilisés dans les composants
   
   Composants supportés:
   - Header (logo + boutons navigation)
   - Sidebar (recherche, agents, conversations)
   - Messages (bulles user/assistant, tool calls, reasoning)
   - Chat Input (textarea + boutons)
   ======================================== */

/* ========================================
   DESIGN TOKENS - SYSTÈME DE THÈMES
   ========================================
   Architecture modulaire pour supporter :
   - Mode sombre (défaut)
   - Mode clair
   - Mode glass/glassmorphism
   - Thèmes personnalisés
   
   Usage : Modifier uniquement les variables de :root
   pour changer l'apparence complète du chat
   ======================================== */

:root {
  /* ========================================
     BACKGROUNDS - Surfaces principales
     ======================================== */
  --chat-bg-primary: #131313;           /* Container, header, messages (assombri -1%) */
  --chat-bg-secondary: #171717;         /* Réservé pour surfaces alternatives (-1%) */
  --chat-bg-tertiary: #191919;          /* Sidebar, chat input area (-1%) */
  --chat-bg-input: #242424;             /* Input search, formulaires (+2%) */
  --chat-bg-input-focus: #2a2a2a;       /* Input au focus (+2%) */
  --chat-bg-user-message: #232323;      /* Bulle message user (+2%) */
  --chat-bg-user-message-hover: #252525; /* Bulle user au hover (+2%) */
  
  /* ========================================
     OVERLAYS - Effets de surface
     ======================================== */
  --chat-overlay-subtle: rgba(255, 255, 255, 0.02);   /* Hover très léger */
  --chat-overlay-soft: rgba(255, 255, 255, 0.03);     /* Backgrounds doux */
  --chat-overlay-active: rgba(255, 255, 255, 0.04);   /* État actif */
  --chat-overlay-input: rgba(255, 255, 255, 0.05);    /* Input backgrounds */
  --chat-overlay-input-focus: rgba(255, 255, 255, 0.08); /* Input focus */
  --chat-overlay-hover: rgba(255, 255, 255, 0.1);     /* Hover buttons */
  --chat-overlay-dark: rgba(0, 0, 0, 0.5);            /* Mobile overlay */
  
  /* Sidebar - Overlays relatifs au background */
  --sidebar-search-overlay: rgba(255, 255, 255, 0.02);     /* Overlay recherche (plus transparent) */
  --sidebar-search-overlay-focus: rgba(255, 255, 255, 0.04); /* Overlay recherche focus */
  --sidebar-item-active: rgba(255, 255, 255, 0.06);   /* Conversation active (subtil) */
  --sidebar-item-hover: rgba(255, 255, 255, 0.04);     /* Conversation hover (très subtil) */
  
  /* ========================================
     TEXTE - Hiérarchie typographique
     ======================================== */
  --chat-text-primary: #b5bcc4;         /* Texte principal (+6% luminosité) */
  --chat-text-secondary: #a3a9b2;       /* Texte secondaire */
  --chat-text-muted: #7a8088;           /* Texte discret, labels */
  --chat-text-code: #838b93;            /* Texte code blocks (muted éclairci ~5%) */
  --chat-text-code-bright: var(--blk-fg); /* ✅ Couleur code blocks/tableaux (avec filter: brightness(1.12)) */
  --chat-text-placeholder: #7c8189;     /* Placeholder input (muted assombri ~1%) */
  --chat-text-success: #22c55e;         /* Texte succès */
  --chat-text-error: #ef4444;           /* Texte erreur */
  --chat-text-error-hover: #dc2626;     /* Texte erreur hover */
  
  /* ========================================
     ACCENTS - Couleurs d'action
     ======================================== */
  --chat-accent-primary: #e55a2b;       /* Bouton envoi, liens */
  --chat-accent-hover: #f5652c;         /* Hover accent */
  
  /* ========================================
     BORDURES - Séparateurs visuels
     ======================================== */
  --chat-border-subtle: rgba(255, 255, 255, 0.1);
  --chat-border-soft: rgba(255, 255, 255, 0.08);
  
  /* ========================================
     STATES - États spéciaux
     ======================================== */
  --chat-bg-success: rgba(34, 197, 94, 0.1);      /* Background succès */
  --chat-bg-error: rgba(239, 68, 68, 0.1);        /* Background erreur */
  --chat-bg-error-hover: rgba(239, 68, 68, 0.2);  /* Background erreur hover */
  --chat-border-error: rgba(239, 68, 68, 0.3);    /* Bordure erreur */
  
  /* ========================================
     TYPOGRAPHIE
     ======================================== */
  /* Les variables sont héritées de typography.css */
  --chat-font-size-base: 15px;
  --chat-line-height-normal: 1.5;
  --chat-line-height-relaxed: 1.75;
  
  /* ========================================
     ESPACEMENTS
     ======================================== */
  --chat-space-sm: 8px;
  --chat-space-md: 12px;
  --chat-space-lg: 16px;
  --chat-space-xl: 24px;
  
  /* ========================================
     PADDINGS RESPONSIVE - SYSTÈME UNIFIÉ
     Appliqués simultanément au container messages et input
     ======================================== */
  --chat-padding-horizontal: 24px;  /* Desktop par défaut */
  --chat-space-2xl: 32px;
  
  /* ========================================
     BORDURES
     ======================================== */
  --chat-radius-md: 8px;
  --chat-radius-lg: 12px;
  --chat-radius-xl: 16px;
  --chat-radius-2xl: 20px;
  
  /* ========================================
     TRANSITIONS
     ======================================== */
  --chat-transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --chat-transition-normal: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* ========================================
     Z-INDEX
     ======================================== */
  --chat-z-sidebar: 1000;
  --chat-z-overlay: 999;
  
  /* ========================================
     DÉGRADÉS - Mode Dark par défaut (éclaircis)
     ======================================== */
  --chat-gradient-input: linear-gradient(135deg, #20202a 0%, #25252f 50%, #20202a 100%);
  --chat-gradient-sidebar: linear-gradient(135deg, #1e1e28 0%, #2a2a35 50%, #1e1e28 100%);
  --chat-gradient-user: linear-gradient(135deg, #20202a 0%, #25252f 50%, #20202a 100%);
  --chat-gradient-user-hover: linear-gradient(135deg, #24242e 0%, #292934 50%, #24242e 100%);
  --chat-gradient-kebab: linear-gradient(135deg, #20202a 0%, #25252f 50%, #20202a 100%);
  --chat-gradient-block: linear-gradient(135deg, #20202a 0%, #25252f 50%, #20202a 100%); /* Code & Mermaid blocks */
  
  /* ✅ Surcharge directe de --blk-bg pour les code blocks */
  --blk-bg: var(--chat-gradient-block);
  
  /* ========================================
     CODE & TABLES BRIGHTNESS FILTER
     ======================================== */
  --code-brightness-filter: brightness(1.18); /* ✅ Filtre réutilisable pour code/tables */
}

/* ========================================
   THÈME CLAIR (LIGHT MODE)
   ========================================
   Usage : Ajouter .chat-theme-light sur body
   ======================================== */
.chat-theme-light {
  /* Backgrounds - Gris moyen moderne (style ChatGPT) */
  --chat-bg-primary: #c8c8c8;          /* Gris moyen foncé */
  --chat-bg-secondary: #e8eaed;        /* Gris moyen */
  --chat-bg-tertiary: #e0e2e5;         /* Gris plus foncé */
  --chat-bg-input: #dde0e4;            /* Input backgrounds */
  --chat-bg-input-focus: #d4d7db;      /* Input focus */
  --chat-bg-user-message: #fff4e6;     /* Bubble user - orange très pâle */
  --chat-bg-user-message-hover: #ffe8cc; /* Bubble user hover - orange pâle */
  
  /* Overlays */
  --chat-overlay-subtle: rgba(0, 0, 0, 0.03);
  --chat-overlay-soft: rgba(0, 0, 0, 0.05);
  --chat-overlay-active: rgba(0, 0, 0, 0.08);
  --chat-overlay-input: rgba(0, 0, 0, 0.06);
  --chat-overlay-input-focus: rgba(0, 0, 0, 0.1);
  --chat-overlay-hover: rgba(0, 0, 0, 0.08);
  --chat-overlay-dark: rgba(0, 0, 0, 0.3);
  
  /* Texte - Gris foncé avec bonne lisibilité */
  --chat-text-primary: #2a2c2e;        /* Gris foncé (éclairci) */
  --chat-text-secondary: #5a5d60;      /* Gris moyen (éclairci) */
  --chat-text-muted: #8a8d90;          /* Gris clair (éclairci) */
  --chat-text-code: #939699;           /* Texte code blocks (muted éclairci ~5%) */
  --chat-text-placeholder: #8b8f93;    /* Placeholder input (muted assombri ~1%) */
  
  /* Sidebar - Overlays inversés pour mode clair */
  --sidebar-search-overlay: rgba(0, 0, 0, 0.02);     /* Overlay recherche (plus transparent) */
  --sidebar-search-overlay-focus: rgba(0, 0, 0, 0.04); /* Overlay recherche focus */
  --sidebar-item-active: rgba(0, 0, 0, 0.06);   /* Conversation active (subtil) */
  --sidebar-item-hover: rgba(0, 0, 0, 0.04);     /* Conversation hover (très subtil) */
  
  /* Bordures */
  --chat-border-subtle: rgba(0, 0, 0, 0.15);
  --chat-border-soft: rgba(0, 0, 0, 0.1);
  
  /* Accents - Orange moderne */
  --chat-accent-primary: #f97316;      /* Orange vif */
  --chat-accent-hover: #ea580c;        /* Orange foncé */
  
  /* Dégradés mode clair - Relatifs au background avec assombrissement */
  --chat-gradient-input: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.08) 0%, 
    rgba(0, 0, 0, 0.15) 50%, 
    rgba(0, 0, 0, 0.08) 100%), 
    var(--chat-bg-primary);
  
  --chat-gradient-sidebar: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.08) 0%, 
    rgba(0, 0, 0, 0.15) 50%, 
    rgba(0, 0, 0, 0.08) 100%), 
    var(--chat-bg-primary);
  
  --chat-gradient-user: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.06) 0%, 
    rgba(0, 0, 0, 0.12) 50%, 
    rgba(0, 0, 0, 0.06) 100%), 
    var(--chat-bg-primary);
  
  --chat-gradient-user-hover: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.1) 0%, 
    rgba(0, 0, 0, 0.18) 50%, 
    rgba(0, 0, 0, 0.1) 100%), 
    var(--chat-bg-primary);
  
  --chat-gradient-kebab: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.08) 0%, 
    rgba(0, 0, 0, 0.15) 50%, 
    rgba(0, 0, 0, 0.08) 100%), 
    var(--chat-bg-primary);
  
  --chat-gradient-block: linear-gradient(135deg, 
    rgba(0, 0, 0, 0.08) 0%, 
    rgba(0, 0, 0, 0.15) 50%, 
    rgba(0, 0, 0, 0.08) 100%), 
    var(--chat-bg-primary); /* Code & Mermaid blocks */
  
  /* ✅ Surcharge directe de --blk-bg pour les code blocks */
  --blk-bg: var(--chat-gradient-block);
}

/* ========================================
   THÈME GLASS (GLASSMORPHISM)
   ========================================
   Usage : Ajouter .chat-theme-glass sur body
   ======================================== */
.chat-theme-glass {
  /* Backgrounds - Glass sobre avec dégradé bleu-violet visible */
  --chat-bg-primary: linear-gradient(135deg, 
    #181a22 0%,           /* Bleu-noir */
    #21233a 50%,          /* Bleu-violet plus prononcé */
    #181a22 100%);        /* Bleu-noir */
  --chat-bg-secondary: #1a1c24;        /* Bleu-noir */
  --chat-bg-tertiary: #1c1e26;         /* Bleu-noir moyen */
  --chat-bg-input: rgba(40, 35, 60, 0.8);     /* Violet avec transparence */
  --chat-bg-input-focus: rgba(50, 42, 75, 0.9);
  --chat-bg-user-message: rgba(45, 38, 70, 0.8);
  --chat-bg-user-message-hover: rgba(55, 45, 85, 0.9);
  
  /* Overlays - Reflets bleu-violet */
  --chat-overlay-subtle: rgba(147, 112, 219, 0.05);   /* Violet clair */
  --chat-overlay-soft: rgba(147, 112, 219, 0.08);
  --chat-overlay-active: rgba(147, 112, 219, 0.12);
  --chat-overlay-input: rgba(147, 112, 219, 0.1);
  --chat-overlay-input-focus: rgba(147, 112, 219, 0.15);
  --chat-overlay-hover: rgba(147, 112, 219, 0.15);
  
  /* Texte - Nuances bleu-violet */
  --chat-text-primary: #e8e4f3;        /* Blanc violet très léger */
  --chat-text-secondary: #c5bfd9;      /* Gris violet clair */
  --chat-text-muted: #9a92b3;          /* Gris violet */
  --chat-text-code: #a49cbf;           /* Texte code blocks (muted éclairci ~5%) */
  --chat-text-placeholder: #9c95b0;    /* Placeholder input (muted assombri ~1%) */
  
  /* Sidebar - Overlays violet pour mode glass */
  --sidebar-search-overlay: rgba(147, 112, 219, 0.05);     /* Overlay recherche (plus transparent) */
  --sidebar-search-overlay-focus: rgba(147, 112, 219, 0.08); /* Overlay recherche focus */
  --sidebar-item-active: rgba(147, 112, 219, 0.08);   /* Conversation active (subtil) */
  --sidebar-item-hover: rgba(147, 112, 219, 0.05);     /* Conversation hover (très subtil) */
  
  /* Bordures - Lueur violette */
  --chat-border-subtle: rgba(147, 112, 219, 0.2);
  --chat-border-soft: rgba(147, 112, 219, 0.15);
  
  /* Dégradés Aurora Glass - Bleu dominant avec transparence */
  --chat-gradient-input: linear-gradient(135deg, 
    rgba(40, 60, 100, 0.6) 0%, 
    rgba(50, 80, 130, 0.4) 50%, 
    rgba(40, 60, 100, 0.6) 100%);
  
  --chat-gradient-sidebar: linear-gradient(135deg, 
    rgba(35, 55, 90, 0.7) 0%, 
    rgba(45, 70, 120, 0.5) 50%, 
    rgba(35, 55, 90, 0.7) 100%);
  
  --chat-gradient-user: linear-gradient(135deg, 
    rgba(45, 65, 105, 0.6) 0%, 
    rgba(55, 85, 135, 0.4) 50%, 
    rgba(45, 65, 105, 0.6) 100%);
  
  --chat-gradient-user-hover: linear-gradient(135deg, 
    rgba(55, 75, 115, 0.7) 0%, 
    rgba(65, 95, 145, 0.5) 50%, 
    rgba(55, 75, 115, 0.7) 100%);
  
  --chat-gradient-kebab: linear-gradient(135deg, 
    rgba(40, 60, 100, 0.7) 0%, 
    rgba(50, 80, 130, 0.5) 50%, 
    rgba(40, 60, 100, 0.7) 100%);
  
  --chat-gradient-block: linear-gradient(135deg, 
    rgba(40, 60, 100, 0.6) 0%, 
    rgba(50, 80, 130, 0.4) 50%, 
    rgba(40, 60, 100, 0.6) 100%); /* Code & Mermaid blocks */
  
  /* ✅ Surcharge directe de --blk-bg pour les code blocks */
  --blk-bg: var(--chat-gradient-block);
}

/* Effet backdrop-filter pour glass mode */
.chat-theme-glass .chatgpt-container,
.chat-theme-glass .sidebar-ultra-clean {
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Chat input OPAQUE pour écrire sans voir le texte derrière */
.chat-theme-glass .chatgpt-input-area {
  background: linear-gradient(135deg, 
    rgba(25, 40, 70, 1) 0%,     /* Bleu foncé assombri */
    rgba(35, 55, 90, 1) 50%,    /* Bleu moyen assombri */
    rgba(25, 40, 70, 1) 100%);  /* Bleu foncé assombri */
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}

/* Header transparent en mode Glass pour laisser passer l'aurore */
.chat-theme-glass .chatgpt-header {
  background: transparent !important;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Input container avec fade-out court pour masquer le texte qui scroll */
.chat-theme-glass .chatgpt-input-container {
  background: linear-gradient(to top, 
    #1a1625 0%,              /* Opaque en bas */
    #1a1625 20%,             /* Opaque jusqu'à 20% */
    rgba(26, 22, 37, 0.5) 40%,  /* Semi-transparent */
    rgba(26, 22, 37, 0) 70%);   /* Transparent à 70% */
  z-index: 100;  /* Au-dessus des messages */
}

/* ========================================
   CONTAINER PRINCIPAL
   ======================================== */

.chatgpt-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--chat-bg-primary);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  font-family: var(--font-chat-text);
  color: var(--chat-text-primary);
}

/* ========================================
   HEADER
   ======================================== */

.chatgpt-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--chat-space-md) var(--chat-space-xl);
  background: var(--chat-bg-primary);
  flex-shrink: 0;
  height: 56px;
  z-index: 1001;
  font-family: var(--font-chat-ui);
}

.chatgpt-header-left {
  display: flex;
  align-items: center;
  gap: 6px;
}

.chatgpt-header-right {
  display: flex;
  align-items: center;
  gap: var(--chat-space-md);
}

/* Agent actif dans le header */
.chat-active-agent {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  transition: all var(--chat-transition-fast);
}

.agent-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  line-height: 1;
}

/* Avatar agent dans header - rond */
.agent-avatar-header {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  object-fit: cover;
}

.agent-name {
  font-size: 14px;
  font-weight: 500;
  color: var(--chat-text-primary);
  white-space: nowrap;
}

.chatgpt-sidebar-toggle-btn-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  background: transparent;
  border: none;
  color: var(--chat-text-secondary);
  cursor: pointer;
  border-radius: 8px;
  transition: all var(--chat-transition-fast);
  width: 36px;
  height: 36px;
}

/* ✅ Pas de hover, style simple */
.chatgpt-sidebar-toggle-btn-header:focus,
.chatgpt-sidebar-toggle-btn-header:focus-visible,
.chatgpt-sidebar-toggle-btn-header:active {
  outline: none;
}

/* ========================================
   SIDEBAR
   ======================================== */

.sidebar-hover-zone {
  position: fixed;
  top: 0;
  left: 0;
  width: 100px;
  height: 100vh;
  z-index: var(--chat-z-sidebar);
  pointer-events: auto;
}

.sidebar-ultra-clean {
  position: fixed;
  top: 56px;
  left: 0;
  height: calc(100vh - 56px - 24px);
  width: 280px;
  background: var(--chat-gradient-sidebar);
  transform: translateX(-280px);
  transition: transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1),
              opacity 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
  z-index: var(--chat-z-sidebar);
  display: flex;
  flex-direction: column;
  padding: 0;
  overflow: hidden;
  margin-bottom: 0;
  border-top-right-radius: var(--chat-radius-2xl);
  border-bottom-right-radius: var(--chat-radius-2xl);
  will-change: transform;
  pointer-events: auto;
  opacity: 1;
  font-family: var(--font-chat-ui);
}

.sidebar-ultra-clean.visible {
  transform: translateX(0);
}

.sidebar-search-clean {
  padding: 16px;
  border-bottom: none;
}

.sidebar-search-clean > div {
  position: relative;
}

.sidebar-search-icon-clean {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--chat-text-muted);
  pointer-events: none;
}

.sidebar-search-input-clean {
  width: 100%;
  padding: 10px 12px 10px 40px;
  background: var(--sidebar-search-overlay);
  border: none;
  border-radius: var(--chat-radius-md);
  color: var(--chat-text-primary);
  font-size: 14px;
  outline: none;
  transition: all var(--chat-transition-fast);
}

.sidebar-search-input-clean:focus {
  background: var(--sidebar-search-overlay-focus);
}

.sidebar-content-clean {
  flex: 1;
  overflow-y: auto;
  padding: var(--chat-space-lg);
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
}

/* Scrollbar sidebar invisible */
.sidebar-content-clean::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
}

.sidebar-section-clean {
  margin-bottom: var(--chat-space-xl);
}

.sidebar-section-header-clean {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--chat-space-md);
}

.sidebar-section-title-clean {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--chat-text-secondary);
  line-height: 1;
  margin: 0;
}

.sidebar-new-conversation-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: transparent;
  border: none;
  color: var(--chat-text-secondary);
  cursor: pointer;
  border-radius: 6px;
  transition: all var(--chat-transition-fast);
}

.sidebar-new-conversation-btn:hover {
  background: var(--sidebar-item-hover);
  color: var(--chat-text-primary);
}

/* Bouton "Voir plus" agents */
.sidebar-show-more-btn {
  width: 100%;
  padding: 8px 12px;
  margin-top: 4px;
  background: transparent;
  border: none;
  color: var(--chat-text-muted);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  text-align: left;
  transition: all var(--chat-transition-fast);
  text-decoration: none;
}

.sidebar-show-more-btn:hover {
  text-decoration: underline;
}

.sidebar-item-clean {
  display: flex;
  align-items: center;
  gap: var(--chat-space-md);
  padding: 8px 12px;
  border-radius: var(--chat-radius-md);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
  color: var(--chat-text-secondary);
  font-size: 14px;
  margin-bottom: 4px;
  width: 100%;
  box-sizing: border-box;
}

.sidebar-item-clean:hover {
  background: var(--sidebar-item-hover);
  color: var(--chat-text-primary);
}

.sidebar-item-clean.active {
  background: var(--sidebar-item-active);
  color: var(--chat-text-primary);
  font-weight: 600;
}

.sidebar-item-icon-clean {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

/* Conteneur avatar - doit être carré pour images rondes */
.sidebar-item-icon-clean:has(.agent-avatar) {
  width: 24px;
  height: 24px;
}

.sidebar-agent-row {
  display: flex;
  align-items: center;
  gap: var(--chat-space-sm);
}

.sidebar-agent-row .sidebar-item-clean {
  font-weight: 600;
}

/* Forcer la largeur des conversations à être identique aux agents */
.sidebar-item-clean button {
  width: 100%;
  text-align: left;
  background: none;
  border: none;
  color: inherit;
  font: inherit;
  cursor: inherit;
  padding: 0;
  margin: 0;
}

.sidebar-item-clean button > div {
  width: 100%;
  padding: 0;
  margin: 0;
}

.sidebar-user-clean {
  padding: var(--chat-space-lg);
  border-top: none;
}

.sidebar-user-item-clean {
  display: flex;
  align-items: center;
  gap: var(--chat-space-md);
  padding: 10px 12px;
  border-radius: var(--chat-radius-md);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
}

.sidebar-user-item-clean:hover {
  background: var(--chat-overlay-subtle);
}

.sidebar-user-avatar-clean {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--chat-accent-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 14px;
  flex-shrink: 0;
}

.sidebar-user-info-clean {
  flex: 1;
}

.sidebar-user-name-clean {
  font-size: 14px;
  font-weight: 500;
  color: var(--chat-text-primary);
}

/* ========================================
   BOUTON SUPPRIMER CONVERSATION
   ======================================== */

.sidebar-conversation-item {
  position: relative;
  margin-bottom: 4px;
}

.sidebar-conversation-item:hover .sidebar-delete-btn {
  opacity: 1;
}

/* Masquer le bouton supprimer en mode renommage */
.sidebar-conversation-item.renaming .sidebar-delete-btn {
  display: none;
}

.sidebar-delete-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  color: var(--chat-text-secondary);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  opacity: 0;
  transition: all var(--chat-transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
}

.sidebar-delete-btn:hover {
  background: var(--chat-overlay-hover);
  color: var(--chat-text-primary);
}

.sidebar-rename-input {
  width: 100%;
  background: var(--chat-overlay-input);
  border: none;
  color: var(--chat-text-primary);
  font-size: 13px;
  font-weight: 500;
  padding: 4px 8px;
  border-radius: 4px;
  outline: none;
  font-family: var(--font-chat-text);
}

.sidebar-rename-input:focus {
  background: var(--chat-overlay-input-focus);
}

/* ========================================
   CONTENT & MESSAGES
   ======================================== */

.chatgpt-content {
  display: flex;
  flex: 1;
  overflow: hidden;
  position: relative;
  margin-left: 0;
  transition: margin-left 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Quand la sidebar est ouverte, décaler le contenu */
.chatgpt-content.sidebar-open {
  margin-left: 280px;
}

/* En mode responsive, garder la largeur fixe et laisser déborder */
@media (max-width: 1023px) {
  /* ✅ Forcer la largeur fixe sur TOUS les containers (sidebar ouverte OU fermée) */
  .chatgpt-messages {
    max-width: none;
    width: 100vw;
    min-width: 100vw;
  }
  
  .chatgpt-input-container {
    width: 100vw;
    max-width: none;
    left: 0;
    right: auto;
  }
  
  .chatgpt-input-area {
    max-width: 1015px;
  }
  
  /* ✅ Décalage uniquement quand sidebar ouverte (pas de resize) */
  .chatgpt-content.sidebar-open {
    margin-left: 280px;
  }
}

.chatgpt-sidebar-overlay {
  display: none;
}

.chatgpt-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

.chatgpt-messages-container {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  background: var(--chat-bg-primary);
  padding-bottom: 100px; /* 🎯 Espace minimal pour streaming */
  position: relative; /* Pour le centrage absolu de l'empty state */
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.08) transparent;
}

/* Scrollbar zone messages ultra discrète et raccourcie */
.chatgpt-messages-container::-webkit-scrollbar {
  width: 8px;
}

.chatgpt-messages-container::-webkit-scrollbar-track {
  background: transparent;
}

.chatgpt-messages-container::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.08);
  background-clip: padding-box;
  border: 3px solid transparent;
  border-radius: 4px;
}

.chatgpt-messages-container::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.12);
  background-clip: padding-box;
}

.chatgpt-messages {
  max-width: 1000px;
  margin: 0 auto;
  padding: var(--chat-space-xl) var(--chat-padding-horizontal);
  position: relative; /* Pour le centrage absolu de l'empty state */
  min-height: 100%; /* S'assure que le conteneur prend toute la hauteur */
  width: 100%;
  box-sizing: border-box;
}

/* 🎨 Animation fade-in fluide pour chargement conversation */
.chatgpt-messages.messages-fade-in {
  animation: messagesFadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

@keyframes messagesFadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chatgpt-message {
  display: flex;
  flex-direction: column;
  margin-bottom: var(--chat-space-lg);
  /* animation: fadeIn 0.2s ease-out; */ /* ✅ DÉSACTIVÉ: Cause clignotement à la fin du stream */
}

/* Texte brut pour messages user */
.chatgpt-message-text-plain {
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: inherit;
  line-height: 1.5;
}

/* Liens dans messages user - cohérent avec markdown */
.user-message-link {
  color: var(--color-accent);
  text-decoration: underline;
  text-underline-offset: 2px;
  text-decoration-thickness: 1px;
  text-decoration-skip-ink: auto;
  transition: color 0.2s ease, text-underline-offset 0.2s ease, text-decoration-thickness 0.2s ease;
  word-break: break-all;
  cursor: pointer;
}

.user-message-link:hover {
  color: var(--color-accent-hover);
  text-underline-offset: 3px;
  text-decoration-thickness: 2px;
}

.chatgpt-message-assistant {
  align-items: flex-start;
}

.chatgpt-message-user {
  align-items: flex-end;
}

.chatgpt-message-bubble {
  padding: var(--chat-space-lg);
  border-radius: var(--chat-radius-xl);
  font-size: var(--chat-font-size-base);
  line-height: var(--chat-line-height-relaxed);
  font-family: var(--font-chat-text);
}

.chatgpt-message-bubble-assistant {
  background: transparent;
  color: var(--chat-text-primary);
  width: 100%;
  max-width: 100%;
  padding: 0;
}

.chatgpt-message-bubble-user {
  background: var(--chat-gradient-user);
  color: var(--chat-text-primary);
  max-width: 70%;
  border: none;
}

.chatgpt-message-bubble-user:hover {
  background: var(--chat-gradient-user-hover);
}

/* Images attachées dans les messages user */
.chatgpt-message-images {
  display: flex;
  flex-direction: column;
  gap: var(--chat-space-sm);
  margin-bottom: var(--chat-space-md);
}

.chatgpt-message-image {
  max-width: 300px;
  max-height: 300px;
  width: 100%;
  height: auto;
  object-fit: contain;
  border-radius: var(--chat-radius-md);
  border: none;
  cursor: pointer;
  transition: all var(--chat-transition-fast);
}

.chatgpt-message-image:hover {
  transform: scale(1.02);
}

/* Responsive mobile - images plus petites */
@media (max-width: 1023px) {
  .chatgpt-message-image {
    max-width: 200px;
    max-height: 200px;
  }
}

.chatgpt-message-content {
  word-wrap: break-word;
  overflow-wrap: break-word;
  padding: 0;
  margin: 0;
  width: 100%;
}

.enhanced-markdown-message {
  padding: 0;
  margin: 0;
  width: 100%;
}

.chat-markdown {
  padding: 0;
  margin: 0;
  width: 100%;
}

.chatgpt-message-reasoning {
  margin-bottom: 4px;
  padding: 0;
  position: relative;
}

.chatgpt-message-loading {
  display: flex;
  align-items: center;
  padding: var(--chat-space-md);
}

.chatgpt-message-loading-dots {
  display: flex;
  gap: 6px;
}

.chatgpt-message-loading-dot {
  width: 8px;
  height: 8px;
  background: var(--chat-text-muted);
  border-radius: 50%;
  animation: pulse 1.4s infinite ease-in-out;
}

.chatgpt-message-loading-dot:nth-child(1) {
  animation-delay: -0.32s;
}

.chatgpt-message-loading-dot:nth-child(2) {
  animation-delay: -0.16s;
}

.chatgpt-message-actions {
  margin-top: var(--chat-space-sm);
  display: flex;
  gap: var(--chat-space-sm);
}

.chatgpt-message-error {
  padding: var(--chat-space-md);
  background: var(--chat-bg-error);
  border: 1px solid var(--chat-border-error);
  border-radius: var(--chat-radius-md);
  color: var(--chat-text-error);
}

/* ========================================
   CHAT INPUT
   ======================================== */

.chatgpt-input-container {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 0 var(--chat-padding-horizontal) 24px;
  background: var(--chat-bg-primary);
  display: flex;
  justify-content: center;
  align-items: flex-end;
  padding-top: 0;
}

.chatgpt-input-area {
  width: 100%;
  max-width: 1015px;
  background: var(--chat-gradient-input);
  border-radius: var(--chat-radius-xl);
  padding: var(--chat-space-md);
  display: flex;
  flex-direction: column;
  gap: var(--chat-space-md);
  box-sizing: border-box;
}

/* État drag & drop */
.chatgpt-input-area.dragging {
  filter: brightness(1.05); /* Éclaircir légèrement */
  transition: filter 0.2s ease;
}

/* Bouton fichier actif pendant le drag */
.chatgpt-input-area.dragging .chatgpt-input-file {
  background: rgba(255, 107, 0, 0.15) !important; /* Orange transparent */
  color: var(--chat-accent-primary) !important;
  border-radius: 50%;
}

.chatgpt-input-textarea {
  width: 100%;
  min-height: 18px;
  max-height: 80px;
  background: transparent;
  border: none;
  font-family: var(--font-chat-text) !important;
  outline: none;
  resize: none;
  font-size: var(--chat-font-size-base);
  line-height: var(--chat-line-height-normal);
  color: var(--chat-text-primary);
  padding: 8px 0 0 8px; /* Padding top augmenté de 5px à 8px */
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--chat-text-muted) transparent;
}

.chatgpt-input-textarea::placeholder {
  color: var(--chat-text-placeholder);
  font-size: calc(var(--chat-font-size-base) * 1.02); /* +2% à peine */
}

.chatgpt-input-textarea:focus::placeholder {
  opacity: 0;
}

.chatgpt-input-textarea::-webkit-scrollbar {
  width: 4px;
}

.chatgpt-input-textarea::-webkit-scrollbar-thumb {
  background: var(--chat-text-muted);
  border-radius: 2px;
}

.chatgpt-input-actions {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 0;
  padding-top: 0;
}

.chatgpt-input-mention,
.chatgpt-input-file,
.chatgpt-input-speaker,
.chatgpt-input-mic,
.chatgpt-input-web-search,
.chatgpt-input-websearch,
.chatgpt-input-reasoning {
  background: transparent;
  border: none;
  color: var(--chat-text-secondary);
  cursor: pointer;
  padding: 8px;
  border-radius: var(--chat-radius-md);
  transition: all var(--chat-transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  position: relative;
}

.chatgpt-input-mention:hover,
.chatgpt-input-file:hover,
.chatgpt-input-speaker:hover,
.chatgpt-input-mic:hover,
.chatgpt-input-web-search:hover,
.chatgpt-input-websearch:hover,
.chatgpt-input-reasoning:hover {
  background: var(--chat-overlay-hover);
  color: var(--chat-text-primary);
  border-radius: var(--chat-radius-md);
}

/* Bouton mention actif */
.chatgpt-input-mention.active {
  background: var(--chat-overlay-active);
  color: var(--chat-accent-primary);
}

/* Bouton fichier actif */
.chatgpt-input-file.active {
  background: var(--chat-overlay-active);
  color: var(--chat-accent-primary);
}


/* Bouton websearch actif */
.chatgpt-input-websearch.active {
  background: var(--chat-overlay-active);
  color: var(--chat-accent-primary);
}

/* Bouton reasoning actif (menu ouvert) */
.chatgpt-input-reasoning.active {
  background: var(--chat-overlay-hover);
  color: var(--chat-text-primary);
}

/* ⚠️ Bouton reasoning avec override (icône orange + fond neutre léger persistant) */
.chatgpt-input-reasoning.override-active {
  background: rgba(255, 255, 255, 0.04);
  color: var(--chat-accent-primary) !important;
}

.chatgpt-input-reasoning.override-active:hover {
  background: rgba(255, 255, 255, 0.08);
  color: var(--chat-accent-primary) !important;
}

/* Badge compteur de fichiers */
.chatgpt-input-file-badge {
  position: absolute;
  top: 2px;
  right: 2px;
  background: var(--chat-accent-primary);
  color: white;
  font-size: 10px;
  font-weight: 600;
  min-width: 16px;
  height: 16px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  pointer-events: none;
}

/* Badge compteur de notes */
.chatgpt-input-mention-badge {
  position: absolute;
  top: 2px;
  right: 2px;
  background: var(--chat-accent-primary);
  color: white;
  font-size: 10px;
  font-weight: 600;
  min-width: 16px;
  height: 16px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  pointer-events: none;
}

/* État enregistrement du micro */
.chatgpt-input-mic-recording {
  background: transparent !important;
  border: 2px solid #ef4444 !important;
  border-radius: 50% !important;
  color: #ef4444 !important;
  animation: pulse-mic-recording 2s infinite;
  width: 40px !important;
  height: 40px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

@keyframes pulse-mic-recording {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
  }
}

.chatgpt-input-send {
  background: linear-gradient(135deg, 
    #e8e8ea 0%, 
    #ffffff 50%, 
    #e8e8ea 100%);
  border: none;
  color: var(--chat-bg-primary); /* Icône en couleur du background pour contraste */
  cursor: pointer;
  padding: var(--chat-space-sm);
  border-radius: 50%;
  transition: all var(--chat-transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: auto;
  width: 40px;
  height: 40px;
}

.chatgpt-input-send:hover {
  background: linear-gradient(135deg, 
    #ffffff 0%, 
    #f5f5f7 50%, 
    #ffffff 100%);
  transform: scale(1.05);
}

.chatgpt-input-send:disabled {
  background: var(--chat-text-placeholder); /* Bouton en couleur placeholder (muted -1%) */
  border: none;
  color: var(--chat-bg-secondary); /* Flèche un poil plus sombre */
  cursor: not-allowed;
  opacity: 1;
}

.chatgpt-input-send:disabled:hover {
  background: var(--chat-text-placeholder);
  transform: none;
}

.chat-input-typing-dots {
  display: flex;
  gap: 3px;
  align-items: center;
  justify-content: center;
}

.chat-input-typing-dot {
  width: 5px;
  height: 5px;
  background: white;
  border-radius: 50%;
  animation: typingDot 1.4s infinite ease-in-out;
}

.chat-input-typing-dot:nth-child(1) {
  animation-delay: -0.32s;
}

.chat-input-typing-dot:nth-child(2) {
  animation-delay: -0.16s;
}

/* ========================================
   BUBBLE BUTTONS - ACTIONS SOUS LES BULLES
   ======================================== */

.bubble-buttons {
  display: flex;
  width: 100%; /* ✅ Prend toute la largeur du container */
  justify-content: flex-start;
  opacity: 0;
  transition: opacity var(--chat-transition-normal);
}

.chatgpt-message:hover .bubble-buttons {
  opacity: 1;
}

.chatgpt-message-user .bubble-buttons {
  justify-content: flex-end; /* ✅ Aligné à droite du container */
  margin-top: -4px; /* ✅ Remonté plus près de la bubble */
}

.chatgpt-message-assistant .bubble-buttons {
  justify-content: flex-start; /* ✅ Aligné à gauche du container */
  margin-top: -4px; /* ✅ Remonté plus près de la bubble */
}

.bubble-buttons-container {
  display: flex;
  gap: 8px;
  align-items: center;
}

.bubble-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: transparent;
  color: var(--chat-text-secondary);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all var(--chat-transition-normal);
  padding: 0;
}

.bubble-button:hover {
  background: var(--chat-overlay-hover);
  color: var(--chat-text-primary);
}

.bubble-button:active {
  transform: scale(0.92);
}

.copy-button.copied {
  color: var(--chat-text-success);
}

.voice-button:hover {
  color: var(--chat-accent-primary);
}

/* ========================================
   EXECUTION BLOCKS - TOOL CALLS
   ======================================== */

.chatgpt-execution-block {
  display: flex;
  justify-content: center;
  margin: 12px 0;
}

/* ========================================
   ANIMATIONS
   ======================================== */

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 80%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  40% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes typingDot {
  0%, 80%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  40% {
    opacity: 1;
    transform: scale(1.2);
  }
}

/* ========================================
   RESPONSIVE - MOBILE
   ======================================== */

/* ========================================
   RESPONSIVE - SYSTÈME DE BREAKPOINTS UNIFIÉ
   Les paddings changent simultanément pour messages et input
   ======================================== */

/* Mobile et tablette (< 1024px) - Correspond au breakpoint React */
@media (max-width: 1023px) {
  :root {
    --chat-padding-horizontal: 16px;  /* ✅ Appliqué simultanément messages + input */
  }
  
  /* ✅ Masquer toutes les scrollbars sur mobile */
  * {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }
  
  *::-webkit-scrollbar {
    display: none; /* Chrome/Safari/Android */
  }
  
  .chatgpt-header {
    padding: var(--chat-space-md);
    height: 56px;
  }
  
  .chatgpt-messages-container {
    padding-bottom: 80px; /* 🎯 Mobile : espace minimal */
  }
  
  .chatgpt-message-bubble-assistant {
    width: 100%;
    max-width: 100%;
  }
  
  .chatgpt-message-bubble-user {
    max-width: 85%;
  }
  
  .chatgpt-content:not(.sidebar-open) .chatgpt-input-area {
    padding: 12px;
  }
  
  .chatgpt-input-textarea {
    font-size: 16px !important; /* Évite le zoom sur iOS */
  }
  
  /* Garde le même style qu'en desktop : 280px avec border-radius */
  .sidebar-ultra-clean {
    /* Hérite des styles desktop (280px, border-radius, etc.) */
    transform: translateX(-280px) !important;  /* ✅ Cachée par défaut */
  }
  
  .sidebar-ultra-clean.visible {
    transform: translateX(0) !important;  /* ✅ Visible avec son style */
  }
  
  .sidebar-hover-zone {
    display: none !important;  /* ✅ Force le masquage */
  }
  
  /* ✅ Plus d'overlay en mobile : la sidebar garde son style et repousse le contenu */
  .chatgpt-sidebar-overlay.visible {
    display: none;
  }
  
  /* ✅ Menu @ (Note Selector) - Adapté à la largeur mobile */
  .chat-note-selector {
    width: 280px; /* Largeur fixe réduite pour mobile */
    max-width: calc(100vw - 80px); /* Ne déborde jamais de l'écran */
  }
  
  /* ✅ Masquer la scrollbar sur mobile */
  .chat-note-list {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }
  
  .chat-note-list::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }
}

/* ========================================
   RESPONSIVE - DESKTOP
   ======================================== */

@media (min-width: 1200px) {
  .chatgpt-input-container {
    padding-left: var(--chat-space-xl);
    padding-right: var(--chat-space-xl);
  }
  
  .chatgpt-input-area {
    max-width: 1015px;
  }
}

/* ========================================
   IMAGE UPLOAD & PREVIEW STYLES
   ======================================== */

/* Zone d'upload d'images */
.chat-image-upload-zone {
  width: 100%;
  margin-bottom: var(--chat-space-md);
}

/* Container des previews */
.chat-image-previews {
  display: flex;
  flex-wrap: wrap;
  gap: var(--chat-space-md);
  margin-bottom: var(--chat-space-md);
}

/* Preview individuelle */
.chat-image-preview {
  position: relative;
  width: 60px;
  height: 60px;
  border-radius: var(--chat-radius-md);
  overflow: hidden;
  border: none;
  transition: all var(--chat-transition-fast);
  cursor: pointer;
}

.chat-image-preview:hover {
  border-color: var(--chat-accent-primary);
  transform: scale(1.05);
}

.chat-image-preview:focus {
  outline: 2px solid var(--chat-accent-primary);
  outline-offset: 2px;
}

/* Image dans le preview */
.chat-image-preview img,
.chat-image-preview-img {
  width: 100%;
  height: 100%;
  object-fit: cover; /* Crop to fill */
  display: block;
}

/* Overlay avec infos */
.chat-image-preview-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
  padding: 4px 6px;
  opacity: 0;
  transition: opacity var(--chat-transition-fast);
}

.chat-image-preview:hover .chat-image-preview-overlay {
  opacity: 1;
}

.chat-image-preview-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.chat-image-preview-filename {
  font-size: 10px;
  color: white;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 500;
}

.chat-image-preview-size {
  font-size: 9px;
  color: rgba(255, 255, 255, 0.7);
}

/* Bouton de suppression */
.chat-image-preview-remove {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 24px;
  height: 24px;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: all var(--chat-transition-fast);
  padding: 0;
}

.chat-image-preview:hover .chat-image-preview-remove {
  opacity: 1;
}

.chat-image-preview-remove:hover {
  background: var(--chat-text-error);
  transform: scale(1.1);
}

/* Badge niveau de détail */
.chat-image-preview-badge {
  position: absolute;
  top: 4px;
  left: 4px;
  background: var(--chat-accent-primary);
  color: white;
  font-size: 9px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Menu contextuel image */
/* Legacy styles supprimés - Fusionnés dans .chat-file-menu */

/* ========================================
   Animations globales pour tous les menus
   ======================================== */

@keyframes menuFadeIn {
  from {
    opacity: 0;
    transform: translateY(8px) scale(0.96);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ========================================
   File Menu (fusionné depuis Image Menu)
   ======================================== */

.chat-file-menu {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 0;
  background: var(--chat-gradient-input);
  border: none;
  border-radius: var(--chat-radius-md);
  padding: 4px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 200px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  animation: menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

.chat-file-menu-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  background: transparent;
  border: none;
  border-radius: 6px;
  color: var(--chat-text-primary);
  font-size: 14px;
  font-family: var(--font-chat-ui);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
  text-align: left;
  width: 100%;
}

.chat-file-menu-item:hover {
  background: var(--sidebar-item-hover);
}

.chat-file-menu-item svg {
  flex-shrink: 0;
  color: var(--chat-text-secondary);
}

/* ========================================
   WebSearch Menu (identique à Image Menu)
   ======================================== */

.chat-websearch-menu {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 0;
  background: var(--chat-gradient-input);
  border: none;
  border-radius: var(--chat-radius-md);
  padding: 4px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 200px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  animation: menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

.chat-menu-header {
  padding: 8px 12px 4px 12px;
  font-size: 12px;
  font-weight: 600;
  color: var(--chat-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: var(--font-chat-ui);
  border-bottom: none;
  margin-bottom: 4px;
}

.chat-websearch-menu-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  background: transparent;
  border: none;
  border-radius: 6px;
  color: var(--chat-text-primary);
  font-size: 14px;
  font-family: var(--font-chat-ui);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
  text-align: left;
  width: 100%;
}

.chat-websearch-menu-item:hover {
  background: var(--sidebar-item-hover);
}

.chat-websearch-menu-item svg {
  flex-shrink: 0;
  color: var(--chat-text-secondary);
}

/* ========================================
   Reasoning Menu (identique à WebSearch Menu)
   ======================================== */

.chat-reasoning-menu {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 0;
  background: var(--chat-gradient-input);
  border: none;
  border-radius: var(--chat-radius-md);
  padding: 4px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 200px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  animation: menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

.chat-reasoning-menu-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  background: transparent;
  border: none;
  border-radius: 6px;
  color: var(--chat-text-primary);
  font-size: 14px;
  font-family: var(--font-chat-ui);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
  text-align: left;
  width: 100%;
}

.chat-reasoning-menu-item:hover {
  background: var(--sidebar-item-hover);
}

.chat-reasoning-menu-item svg {
  flex-shrink: 0;
  color: var(--chat-text-secondary);
}

/* Item sélectionné (garde le hover visible) */
.chat-reasoning-menu-item.selected {
  background: var(--sidebar-item-hover);
}

/* Checkmark */
.chat-reasoning-menu-item .checkmark {
  margin-left: auto;
  color: var(--chat-accent-primary);
  font-weight: bold;
  font-size: 16px;
}

/* Tooltips rapides pour les items de menu */
.chat-reasoning-menu-item[title],
.chat-websearch-menu-item[title],
.chat-file-menu-item[title] {
  position: relative;
}

/* Note: Les tooltips natifs (title) ne peuvent pas être stylés en CSS pur.
   Pour un délai instantané, il faudrait un composant tooltip custom.
   Mais le hover sur les items rend le tooltip moins crucial. */

/* ========================================
   Empty State (Chat vide)
   ======================================== */

.chat-empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  padding: 60px 40px;
  text-align: center;
  animation: fadeIn 0.5s cubic-bezier(0.22, 1, 0.36, 1);
  max-width: 500px;
  margin: 0 auto;
  height: 100%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.chat-empty-agent-avatar {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  overflow: hidden;
  background: var(--chat-bg-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  margin-bottom: 6px;
}

.chat-empty-agent-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.chat-empty-agent-placeholder {
  font-size: 64px;
  line-height: 1;
}

.chat-empty-agent-name {
  font-size: 28px;
  font-weight: 600;
  color: var(--chat-text-primary);
  margin: 0;
  font-family: var(--font-chat-ui);
  letter-spacing: -0.02em;
}

.chat-empty-agent-description {
  font-size: 15px;
  color: var(--chat-text-muted);
  margin: 0;
  line-height: 1.6;
  font-family: var(--font-chat-text);
  max-width: 400px;
  text-align: center;
}

.chat-empty-agent-model {
  display: inline-flex;
  align-items: center;
  padding: 6px 16px;
  background: var(--chat-bg-secondary);
  border-radius: 20px;
  font-size: 13px;
  color: var(--chat-text-muted);
  font-family: var(--font-chat-ui);
  font-weight: 500;
  letter-spacing: 0.02em;
  margin-top: 4px;
}

/* ========================================
   Note Selector Menu & Pills
   ======================================== */

/* Menu Note Selector */
.chat-note-selector {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 0;
  background: var(--chat-gradient-input);
  border: none;
  border-radius: var(--chat-radius-md);
  padding: 8px;
  width: 380px; /* Largeur fixe */
  max-height: 300px; /* ~5 notes visibles */
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  animation: menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: max-height 0.3s cubic-bezier(0.22, 1, 0.36, 1); /* Smooth resize */
}

/* Search input dans le selector */
.chat-note-search-container {
  position: relative;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.02); /* Ultra subtil */
  border-radius: var(--chat-radius-md);
  border: none;
  transition: background var(--chat-transition-fast);
}

.chat-note-search-container:focus-within {
  background: rgba(255, 255, 255, 0.03); /* Focus très léger */
}

.chat-note-search-icon {
  color: var(--chat-text-muted);
  flex-shrink: 0;
}

.chat-note-search-input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: var(--chat-text-primary);
  font-size: 14px;
  font-family: var(--font-chat-ui);
}

.chat-note-search-input::placeholder {
  color: var(--chat-text-placeholder);
}

/* Header liste des notes */
.chat-note-list-header {
  padding: 4px 8px 2px 8px; /* Réduit padding bottom de 4px → 2px */
  font-size: 11px;
  font-weight: 600;
  color: var(--chat-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: var(--font-chat-ui);
}

/* Liste des notes */
.chat-note-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
  max-height: none; /* Pas de limite pour voir au moins 5 notes */
  overflow-y: auto;
  scroll-behavior: smooth; /* Scroll fluide */
  scrollbar-gutter: stable; /* Évite le jump quand scrollbar apparaît */
  position: relative;
}

/* Scrollbar invisible */
.chat-note-list::-webkit-scrollbar {
  width: 0;
  display: none;
}

/* État vide */
.chat-note-list-empty {
  padding: 40px 20px;
  text-align: center;
  color: var(--chat-text-muted);
  font-size: 13px;
  font-family: var(--font-chat-ui);
  animation: fadeIn 0.2s ease;
}

/* État chargement (garde la hauteur du menu stable) */
.chat-note-list-loading {
  padding: 60px 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  height: 240px; /* Hauteur fixe correspondant à ~5 notes (300px - 60px header/padding) */
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.chat-note-loading-spinner {
  width: 28px;
  height: 28px;
  border: 2.5px solid var(--chat-border-subtle);
  border-top: 2.5px solid var(--chat-text-muted);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.chat-note-loading-text {
  color: var(--chat-text-muted);
  font-size: 13px;
  font-family: var(--font-chat-ui);
}

/* Item de note */
.chat-note-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  background: transparent;
  border: none;
  border-radius: 6px;
  color: var(--chat-text-primary);
  font-size: 14px;
  font-family: var(--font-chat-ui);
  cursor: pointer;
  transition: all var(--chat-transition-fast);
  text-align: left;
  width: 100%;
  animation: noteItemFadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) backwards;
}

/* Animation d'apparition progressive pour chaque note */
.chat-note-item:nth-child(1) { animation-delay: 0.02s; }
.chat-note-item:nth-child(2) { animation-delay: 0.04s; }
.chat-note-item:nth-child(3) { animation-delay: 0.06s; }
.chat-note-item:nth-child(4) { animation-delay: 0.08s; }
.chat-note-item:nth-child(5) { animation-delay: 0.10s; }
.chat-note-item:nth-child(6) { animation-delay: 0.12s; }
.chat-note-item:nth-child(7) { animation-delay: 0.14s; }
.chat-note-item:nth-child(8) { animation-delay: 0.16s; }
.chat-note-item:nth-child(9) { animation-delay: 0.18s; }
.chat-note-item:nth-child(10) { animation-delay: 0.20s; }

@keyframes noteItemFadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chat-note-item:hover {
  background: var(--sidebar-item-hover);
}

.chat-note-item.selected {
  background: var(--sidebar-item-hover);
}

.chat-note-item svg {
  flex-shrink: 0;
  color: var(--chat-text-secondary);
}

.chat-note-item-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
  overflow: hidden;
}

.chat-note-item-title {
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-note-item-meta {
  font-size: 12px;
  color: var(--chat-text-muted);
}

/* Pills des notes sélectionnées */
.chat-selected-notes {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 4px 8px 0 8px; /* Réduit padding top de 8px → 4px */
}

.chat-note-pill {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 12px; /* Réduit de 6px à 4px */
  background: var(--sidebar-item-hover); /* Fond subtil sans bordure */
  border: none;
  border-radius: 20px; /* Pill shape */
  color: var(--chat-text-primary);
  font-size: 13px;
  font-family: var(--font-chat-ui);
  transition: all var(--chat-transition-fast);
}

.chat-note-pill:hover {
  background: var(--sidebar-item-active); /* Légèrement plus sombre au hover */
}

.chat-note-pill svg {
  color: var(--chat-text-secondary);
  flex-shrink: 0;
}

.chat-note-pill-title {
  font-weight: 500;
  white-space: nowrap;
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-note-pill-remove {
  background: transparent;
  border: none;
  color: var(--chat-text-muted);
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
  padding: 0;
  margin-left: 4px;
  transition: color var(--chat-transition-fast);
}

.chat-note-pill-remove:hover {
  color: var(--chat-accent-primary);
}

/* Container pour les images preview */
.chat-images-preview-container {
  display: flex;
  gap: 8px;
  padding: 0 0 4px 8px; /* Aligné avec textarea */
  flex-wrap: wrap;
  background: transparent;
  margin-bottom: 0;
}

/* Zone de drop */
.chat-image-drop-zone {
  width: 100%;
  min-height: 120px;
  border: 2px dashed var(--chat-border-subtle);
  border-radius: var(--chat-radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--chat-transition-fast);
  cursor: pointer;
  background: var(--chat-overlay-subtle);
}

.chat-image-drop-zone:hover {
  border-color: var(--chat-accent-primary);
  background: var(--chat-overlay-soft);
}

.chat-image-drop-zone.dragging {
  border-color: var(--chat-accent-primary);
  background: var(--chat-overlay-active);
  border-style: solid;
  transform: scale(1.02);
}

.chat-image-drop-zone.processing {
  cursor: wait;
  opacity: 0.7;
}

/* Contenu de la zone de drop */
.chat-image-drop-zone-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--chat-space-md);
  padding: var(--chat-space-lg);
  text-align: center;
  color: var(--chat-text-secondary);
}

.chat-image-drop-zone-text {
  font-size: 14px;
  color: var(--chat-text-primary);
}

.chat-image-drop-zone-button {
  color: var(--chat-accent-primary);
  text-decoration: underline;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  font-size: inherit;
  font-weight: 500;
  transition: color var(--chat-transition-fast);
}

.chat-image-drop-zone-button:hover {
  color: var(--chat-accent-hover);
}

.chat-image-drop-zone-hint {
  font-size: 12px;
  color: var(--chat-text-muted);
}

/* Spinner de traitement */
.chat-image-processing-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--chat-overlay-hover);
  border-top-color: var(--chat-accent-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Avertissement limite atteinte */
.chat-image-limit-warning {
  display: flex;
  align-items: center;
  gap: var(--chat-space-sm);
  padding: var(--chat-space-md);
  background: var(--chat-bg-error);
  border: 1px solid var(--chat-border-error);
  border-radius: var(--chat-radius-md);
  color: var(--chat-text-error);
  font-size: 13px;
}

/* Responsive mobile */
@media (max-width: 1023px) {
  .chat-image-preview {
    width: 64px;
    height: 64px;
  }
  
  .chat-image-drop-zone {
    min-height: 100px;
  }
  
  .chat-image-drop-zone-content {
    padding: var(--chat-space-md);
  }
  
  .chat-image-drop-zone-text {
    font-size: 13px;
  }
  
  .chat-image-previews {
    gap: var(--chat-space-sm);
  }
}

/* ✅ Light mode support - DÉSACTIVÉ car géré par .chat-theme-light */
/* @media (prefers-color-scheme: light) {
  .chatgpt-message-bubble-user {
    background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
  }
  
  .chatgpt-message-bubble-user:hover {
    background: linear-gradient(135deg, #f0f0f0 0%, #e3e3e3 100%);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }
  
  .chatgpt-input-area {
    background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
  }
  
  .sidebar-ultra-clean {
    background: linear-gradient(135deg, #f0f0f0 0%, #e3e3e3 100%);
  }
  
  /* Removed - Now uses variables that adapt automatically */
  /*
  .sidebar-item-clean.active {
    background: #e8e8e8;
  }
  */

