/**
 * Chat Mobile Responsive Styles
 * Media queries 320px → 1024px, touch optimizations
 * Standard JEAN-CLAUDE: Mobile-first, <300 lignes
 */

/* Fix overflow général */
.chatgpt-container,
.chatgpt-content {
  overflow-x: hidden;
  max-width: 100vw;
}

/* Sur mobile, neutraliser le background-image du body (radial-gradients chauds)
   qui transparaît sous le chat input et crée la bande marron */
@media (max-width: 1023px) {
  body:has(.chatgpt-container) {
    background-image: none !important;
  }
  .chatgpt-container {
    background-image: none !important;
  }
}

/* ========== MOBILE SMALL (320px - 375px) ========== */

@media (max-width: 375px) {
  .chat-markdown { font-size: var(--chat-font-size-base); font-weight: var(--chat-weight-normal); line-height: var(--chat-line-height-normal); }
  .chat-markdown h1 { font-size: 1.75rem !important; }
  .chat-markdown h2 { font-size: 1.35rem !important; }
  .chat-markdown h3 { font-size: 1.15rem !important; }
  .chat-input-textarea { font-size: var(--chat-font-size-base); min-height: 40px; padding: 10px 12px; }
  .chat-stop-btn { padding: 6px 10px; font-size: 12px; }
  .chat-send-btn { width: 40px; height: 40px; padding: 8px; }
  .chat-message { padding: 10px 12px; margin-bottom: 12px; }
  .tool-call-item { padding: 8px 10px; font-size: 13px; }
  .chat-markdown pre { font-size: var(--chat-text-sm, 0.875rem); padding: 10px; overflow-x: auto; }
}

/* ========== MOBILE (376px - 768px) ========== */

@media (max-width: 768px) {
  /* Quand le clavier apparaît : on réduit la hauteur du container (pas seulement bottom)
     pour que messages + input remontent ensemble. Sans ça, seul l'input bouge. */
  .chatgpt-container {
    height: 100vh;
    height: 100dvh;
    height: calc(100dvh - var(--keyboard-inset, 0px));
    padding-top: 0;
    bottom: auto !important;
    top: 0 !important;
    transition: height 0.25s ease-out;
  }
  
  .chatgpt-main {
    height: 100%;
    flex: 1;
    min-height: 0;
  }
  
  .chatgpt-messages-container {
    flex: 1;
    min-height: 0;
    padding-bottom: 120px; /* Espace sous le dernier message pour l'input */
  }
  
  /* Input fixe en bas du container (même position que container bottom). */
  .chatgpt-input-container {
    position: fixed;
    bottom: var(--keyboard-inset, 0px);
    left: 0;
    right: 0;
    z-index: 10;
    padding: 8px var(--chat-padding-horizontal, 12px);
    padding-bottom: max(15px, env(safe-area-inset-bottom, 0px)); /* 12 + 3 px mobile */
    background: var(--chat-bg-primary, #0e1012);
    transition: bottom 0.25s ease-out;
  }
  
  /* Désactiver le gradient fade-to-transparent sur mobile : l'input a un fond solide,
     le ::before crée une ligne visible (séparateur) si le fond du container derrière diffère. */
  .chatgpt-input-container::before {
    display: none !important;
  }
  
  /* Containers */
  .chat-messages-container { max-width: 100%; padding: 0 var(--chat-padding-horizontal, 12px); }
  
  /* Header fixe : reste visible quand le clavier s'ouvre, ne disparaît pas sous la barre de statut */
  .chatgpt-header {
    position: fixed;
    top: env(safe-area-inset-top, 0px);
    left: 0;
    right: 0;
    z-index: 1001;
    height: 56px;
    padding-top: 8px;
    padding-right: var(--chat-padding-horizontal, 12px);
    padding-bottom: 8px;
    padding-left: var(--chat-padding-horizontal, 12px);
    flex-wrap: wrap;
    gap: 8px;
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
    box-sizing: border-box;
  }
  /* Contenu sous le header fixe (évite que le chat passe sous la barre de notification) */
  .chatgpt-content {
    margin-top: calc(56px + env(safe-area-inset-top, 0px));
  }
  
  .chatgpt-header-left,
  .chatgpt-header-right { flex-shrink: 1; min-width: 0; overflow: hidden; }
  
  .chat-header { padding: 8px var(--chat-padding-horizontal, 12px); flex-wrap: wrap; gap: 8px; }
  .chat-header-title { font-size: 16px; }
  .chat-header-actions { gap: 6px; }
  
  /* Input */
  .chat-input-container { padding: 8px var(--chat-padding-horizontal, 12px); }
  .chat-input-wrapper { gap: 8px; }
  
  /* Sidebar - Overlay */
  .chat-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  .chat-sidebar.open { transform: translateX(0); }
  
  /* Messages : copier / haut-parleur toujours visibles (pas de hover sur tactile) */
  .chatgpt-message-assistant .bubble-buttons {
    opacity: 1;
  }

  /* Messages */
  .chat-message { padding: 12px; }
  .chat-message-user { max-width: 90%; }
  .chat-message-assistant { max-width: 100%; }
  .chat-avatar { width: 32px; height: 32px; font-size: 14px; }
  
  /* Modals - Fullscreen */
  .modal-overlay .modal-content {
    width: 100%;
    height: 100vh;
    max-width: 100%;
    max-height: 100vh;
    border-radius: 0;
  }
  
  .settings-modal-content { padding: 16px; }
  .agent-selector-dropdown { max-height: 60vh; }
  .tool-result-content { font-size: 13px; max-height: 200px; }
  .reasoning-dropdown { font-size: 13px; }
}

/* ========== TABLET (769px - 1024px) ========== */

@media (min-width: 769px) and (max-width: 1024px) {
  .chat-messages-container { max-width: 680px; margin: 0 auto; }
  .chat-header { padding: 12px 20px; }
  .chat-input-container { padding: 12px 20px; }
  .chat-sidebar { width: 320px; }
}

/* ========== TOUCH OPTIMIZATIONS ========== */

@media (hover: none) and (pointer: coarse) {
  button, .clickable, .chat-button, .tool-call-toggle, .reasoning-toggle {
    min-height: 44px;
    min-width: 44px;
  }
  .chat-input-textarea { -webkit-tap-highlight-color: transparent; }
  a { padding: 4px 0; }
  .chat-messages-area::-webkit-scrollbar { display: none; }
  select { appearance: auto; -webkit-appearance: auto; }
}

/* ========== KEYBOARD UX iOS ========== */

@supports (-webkit-touch-callout: none) {
  /* iOS : même layout, body fixed pour éviter scroll parasite */
  body { 
    position: fixed; 
    width: 100%; 
  }
  .chat-messages-area { 
    padding-bottom: calc(var(--input-height, 80px) + 20px); 
  }
}

/* ========== LANDSCAPE MODE ========== */

@media (max-width: 768px) and (orientation: landscape) {
  .chat-header { padding: 6px 12px; }
  .chat-header-title { font-size: 14px; }
  .chat-input-textarea { min-height: 36px; padding: 8px 12px; }
  .chat-messages-container { padding: 0 20px; }
  .modal-overlay .modal-content { width: 100%; height: 100vh; }
}

/* ========== TABLET LANDSCAPE (768px - 1024px) ========== */

@media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
  /* Chat container optimisé paysage */
  .chatgpt-messages-container {
    max-width: 900px;
    margin: 0 auto;
  }
  
  /* Header compact en hauteur */
  .chatgpt-header {
    height: 48px;
    padding: 8px 20px;
  }
  
  /* Input compact en hauteur */
  .chatgpt-input-area {
    padding: 8px 20px;
  }
  
  .chatgpt-input-textarea {
    min-height: 40px;
    max-height: 120px;
  }
  
  /* Messages prennent plus d'espace horizontal */
  .chatgpt-message-bubble-user {
    max-width: 60%;
  }
  
  .chatgpt-message-bubble-assistant {
    max-width: 85%;
  }
  
  /* Sidebar peut rester visible en paysage tablette */
  .chat-sidebar {
    width: 280px;
  }
  
  /* Safe areas latérales */
  .chatgpt-container {
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }
}

/* ========== ACCESSIBILITY ========== */

@media (prefers-contrast: high) {
  .chat-markdown { color: var(--chat-text-primary); font-weight: var(--chat-weight-medium); }
  .chat-message { border: 2px solid var(--color-border); }
}

@media (max-width: 768px) {
  .chat-messages-area {
    /* scroll-behavior: smooth; */ /* ⚠️ Géré dans scroll-performance.css */
    -webkit-overflow-scrolling: touch;
  }
  .chat-message { animation: none; }
  .chat-message-content { will-change: auto; }
}

@media (max-width: 768px) and (prefers-color-scheme: dark) {
  .chat-markdown { color: var(--chat-text-primary); }
  .chat-markdown code { background: rgba(255, 255, 255, 0.1); }
}

/* ========== NOTCH/SAFE AREAS ========== */

@supports (padding: max(0px)) {
  @media (max-width: 768px) {
    .chat-header { padding-top: max(12px, env(safe-area-inset-top)); }
    .chat-input-container { padding-bottom: max(12px, env(safe-area-inset-bottom)); }
  }
}

/* ========== REDUCED MOTION ========== */

@media (prefers-reduced-motion: reduce) {
  .chat-sidebar { transition: none; }
  .chat-message { animation: none; }
  * { scroll-behavior: auto !important; }
}
