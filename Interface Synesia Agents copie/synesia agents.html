<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synesia - AI Agent</title>
    
    <!-- Importation des polices Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@500;600;700&family=Noto+Sans:wght@400;500&display=swap" rel="stylesheet">
    <!-- Feuille de style principale -->
    <link id="theme-style" rel="stylesheet" href="styles/macos-dark.css">
    <!-- CodeMirror Assets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/fold/foldgutter.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/json/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/hint/javascript-hint.min.js"></script>
    <!-- Les autres styles seront ajoutés plus tard -->
</head>
<body>

    <div class="aurora">
        <div class="aurora__item"></div>
        <div class="aurora__item"></div>
        <div class="aurora__item"></div>
    </div>
    
    <div class="page-wrapper">

        <header class="app-header">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                  <path fill="var(--primary-color)" d="M50 0 L93.3 25 V75 L50 100 L6.7 75 V25 Z"></path>
                  <path fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="3" d="M50 10 L86.6 30 V70 L50 90 L13.4 70 V30 Z"></path>
                </svg>
                <span class="logo-text">synesia</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M208,28H72a20,20,0,0,0-20,20V228a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48Z" opacity="0.2"/><path d="M208,28H72a20,20,0,0,0-20,20V228a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><polyline points="152 28 152 84 208 84" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M40,200H24a8,8,0,0,0-8,8v12H208V228a20,20,0,0,0-20,20H72a20,20,0,0,0-20-20V48a20,20,0,0,0-20-20H32a8,8,0,0,1,8,8Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg> Save</button>
                <button class="btn"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M140,212.06a12,12,0,0,1-11.39-16,84.06,84.06,0,0,0-76-56.3,12,12,0,1,1,1-24,108.1,108.1,0,0,1,98,72.16A12,12,0,0,1,140,212.06Z"/><path d="M216,48a12,12,0,0,0-12,12,60.1,60.1,0,0,1-53.88,59.3,12,12,0,0,0,0,23.4,84.09,84.09,0,0,0,65.26-62.75,12,12,0,0,0-11.44-16C203.94,64,203.94,48,216,48Z"/></svg> Test</button>
            </div>
        </header>

        <div class="app-container" id="app-container">

            <!-- ===== COLONNE DE GAUCHE (Navigation) ===== -->
            <aside class="sidebar-left" id="sidebar">
                <div class="sidebar-header">
                   <div class="logo">
                       <!-- Espace réservé pour la symétrie -->
                   </div>
                </div>
                <div class="current-project current-project-active">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <svg class="icon" viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 11.5L12 4L21 11.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 10V20H19V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Abrège
                    </span>
                    <span class="arrow">&raquo;</span>
                </div>

                <nav class="navigation">
                    <div class="nav-group">
                        <h3>WORKSPACE</h3>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><rect width="80" height="80" x="40" y="40" rx="8" opacity="0.2"/><rect width="80" height="80" x="40" y="40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" rx="8"/><rect width="80" height="80" x="136" y="40" rx="8" opacity="0.2"/><rect width="80" height="80" x="136" y="40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" rx="8"/><rect width="80" height="80" x="40" y="136" rx="8" opacity="0.2"/><rect width="80" height="80" x="40" y="136" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" rx="8"/><rect width="80" height="80" x="136" y="136" rx="8" opacity="0.2"/><rect width="80" height="80" x="136" y="136" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" rx="8"/></svg><span>Dashboard</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M216,48V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H208A8,8,0,0,1,216,48Z" opacity="0.2"/><path d="M216,48V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H208A8,8,0,0,1,216,48Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="168" x2="88" y1="128" y2="128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="168" x2="88" y1="160" y2="160" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="120" x2="88" y1="96" y2="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg><span>Project</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M140,212.06a12,12,0,0,1-11.39-16,84.06,84.06,0,0,0-76-56.3,12,12,0,1,1,1-24,108.1,108.1,0,0,1,98,72.16A12,12,0,0,1,140,212.06Z"/><path d="M216,48a12,12,0,0,0-12,12,60.1,60.1,0,0,1-53.88,59.3,12,12,0,0,0,0,23.4,84.09,84.09,0,0,0,65.26-62.75,12,12,0,0,0-11.44-16C203.94,64,203.94,48,216,48Z"/></svg><span>Runs & Tests</span></a>
                    </div>
                    <div class="nav-group">
                        <h3>INTEGRATIONS</h3>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Z" opacity="0.2"/><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="16"/><path d="M128,112a47.88,47.88,0,0,1,34.12,14.54L181.41,108a8,8,0,0,1,11.32,0l18.34,18.34a8,8,0,0,1,0,11.32L192.73,156A48,48,0,1,1,128,112Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg><span>API Integrations</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M92.7,144a8,8,0,0,1-11.31-11.31L120,94.06l-28-28A8,8,0,0,1,103.31,54.7l32,32a8,8,0,0,1,0,11.31l-32,32A8,8,0,0,1,92.7,144Z"/><path d="M149.32,201.29l-32-32a8,8,0,0,1,0-11.31l32-32a8,8,0,0,1,11.31,11.31L136,160l28.69,28.69a8,8,0,0,1-11.32,11.31Z"/><path d="M200,56H168a8,8,0,0,0,0,16h24V96a8,8,0,0,0,16,0V64A8,8,0,0,0,200,56Z"/><path d="M56,200H88a8,8,0,0,0,0-16H64V160a8,8,0,0,0-16,0v32A8,8,0,0,0,56,200Z"/><path d="M88,112a8,8,0,0,0-16,0v32a8,8,0,0,0,16,0Z"/><path d="M184,112a8,8,0,0,0-16,0v32a8,8,0,0,0,16,0Z"/></svg><span>Webhooks</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Z" opacity="0.2"/><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="16"/><path d="M128,72a20,20,0,0,1,20,20,20.59,20.59,0,0,1-3.64,11.45L128,144l-16.36-40.55A20.59,20.59,0,0,1,108,92a20,20,0,0,1,20-20Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="128" x2="128" y1="168" y2="184" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg><span>MCP</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M162.24,198.24a80,80,0,0,1-113.13-22.62l34.1-34.1a32,32,0,0,1,45.25-45.25l34.09-34.1a80,80,0,0,1-22.62,113.13l-4.44,4.44a8,8,0,0,1-11.31-11.31l4.44-4.44a64,64,0,0,0,15.1-93.59L129.41,83.08a16,16,0,0,0-22.62-22.62L83.08,84.17,66.36,67.45a8,8,0,0,0-11.31,11.31l16.71,16.71a16,16,0,0,0,22.63,22.63l23.71-23.71,11.32,11.31a8,8,0,1,0,11.31-11.31Z"/><path d="M216,40a8,8,0,0,0-8,8,64,64,0,0,1-93.59,49.49l-4.44,4.44a8,8,0,0,0,11.31,11.31l4.44-4.44a80,80,0,0,0,93.59-49.49A8,8,0,0,0,216,40Z"/></svg><span>OAuth</span></a>
                    </div>
                    <div class="nav-group">
                        <h3>AUTOMATION</h3>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><circle cx="128" cy="128" r="88" opacity="0.2"/><circle cx="128" cy="128" r="88" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="16"/><polyline points="128 72 128 128 168 128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg><span>Scheduler</span></a>
                    </div>
                     <div class="nav-group">
                        <h3>USAGE</h3>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><rect width="256" height="256" fill="none"/><line x1="80" x2="80" y1="168" y2="88" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="128" x2="128" y1="168" y2="40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="176" x2="176" y1="168" y2="120" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="40" x2="216" y1="208" y2="208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg><span>UsageOverview</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 24 24" fill="none" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M8 7H16M8 11H16M8 15H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Token Cost Simulator</span></a>
                    </div>
                    <div class="nav-group">
                        <h3>SETTINGS</h3>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M176,80a48,48,0,0,0-96,0v40H64v96H192V120H176Z" opacity="0.2"/><rect x="64" y="120" width="128" height="96" rx="8" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M176,80a48,48,0,0,0-96,0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><circle cx="128" cy="168" r="12"/></svg><span>Général</span></a>
                        <a href="#" class="nav-item"><svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M168,88.63a48,48,0,1,1-80.05.05L49.37,45.37a8,8,0,0,1,11.32-11.32L93.31,66.69A47.89,47.89,0,0,1,128,64a47.45,47.45,0,0,1,22.4,5.49L176,44.05a8,8,0,1,1,11.31,11.31Z"/><path d="M192,128a32,32,0,1,1-43.31,30.63l-28,28a8,8,0,0,1-11.32-11.32l28-28A32,32,0,1,1,192,128Z"/></svg><span>Secrets</span></a>
                    </div>
                    <!-- MARKETPLACE bouton stand-alone -->
                    <div class="nav-group">
                        <button class="nav-item" id="marketplace-btn" style="width: 100%; text-align: left;">
                            <span>Marketplace</span>
                        </button>
                    </div>
                </nav>
                <div class="account-section">
                     <a href="#" class="nav-item">
                        <svg class="icon" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><circle cx="128" cy="128" r="88" opacity="0.2"/><circle cx="128" cy="128" r="88" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="16"/><circle cx="128" cy="120" r="32" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="16"/><path d="M63.8,199.37a80.21,80.21,0,0,1,128.4,0" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                        <span>Mon Compte</span>
                    </a>
                </div>
            </aside>

            <!-- ===== ZONE CENTRALE (Workspace) ===== -->
            <main class="main-content glass-panel">
                <div class="agent-id-card">
                    <div class="top-row" style="align-items: stretch;">
                        <div class="agent-avatar" style="display: flex; align-items: flex-start; height: auto;">
                            <img src="assets/robot-agent.png" alt="Avatar de l'agent" id="agent-avatar-img">
                        </div>
                        <div class="agent-info-col" style="display: flex; flex-direction: column; justify-content: flex-start; flex: 1; gap: 8px;">
                        <input class="agent-name-input" type="text" value="Andy">
                            <p class="agent-description-text" id="agent-description-text">Assistant qui répond exclusivement au format Markdown.</p>
                            <textarea class="agent-description-input agent-description-field" id="agent-description-input" placeholder="Description de l'agent..." rows="2" style="display:none">Assistant qui répond exclusivement au format Markdown.</textarea>
                        </div>
                    </div>
                </div>
                <div class="content-section">
                        <h3>Instructions</h3>
                    <div class="prompt-area-wrapper">
                        <textarea class="prompt-area" id="prompt-area" placeholder="Décrivez le rôle, les capacités et les limites de votre agent...">- Tu respectes les **sauts de ligne Markdown** (1 ligne vide entre deux paragraphes),
- Tu utilises la **syntaxe `*mot*` ou `_mot_`** pour les *mots* et les **`**mots**`** ou `__mots__`** pour les **mots**,
- Jamais de balises HTML. Tu utilises uniquement du **Markdown pur**.</textarea>
                         <button class="btn-fullscreen" title="Édition plein écran">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                 <div class="content-section">
                    <h3>Input Format</h3>
                    <div class="format-selector-box">
                       <span>T</span>
                    </div>
                </div>
                 <div class="content-section">
                    <h3>Output Format</h3>
                    <div class="format-selector-box">
                       <span>T</span>
                    </div>
                </div>
            </main>

            <!-- ===== COLONNE DE DROITE (Configuration) ===== -->
            <aside class="sidebar-right glass-panel">
                <h2 style="text-transform: uppercase; letter-spacing: 0.5px;">Configuration</h2>
                
                <div class="parameters-group">
                    <div class="config-section" style="gap: 20px;">
                         <div class="param-item">
                            <label>Modèle</label>
                            <div class="custom-dropdown" id="model-dropdown">
                                <div class="custom-dropdown-button">
                                    <span id="selected-model">Gemini 2.5 Pro</span>
                                </div>
                                <div class="custom-dropdown-options">
                                    <div class="custom-dropdown-option" data-value="Gemini 1.5 Flash">Gemini 1.5 Flash</div>
                                    <div class="custom-dropdown-option selected" data-value="Gemini 2.5 Pro">Gemini 2.5 Pro</div>
                                    <div class="custom-dropdown-option" data-value="Claude 3 Opus">Claude 3 Opus</div>
                                </div>
                            </div>
                        </div>
                        <div class="param-grid">
                            <div class="param-item">
                                <label>Temperature</label>
                                <input type="range" min="0" max="1" step="0.01" value="0.8">
                            </div>
                             <div class="param-item">
                                <label>Top P</label>
                                <input type="range" min="0" max="1" step="0.01" value="0.95">
                            </div>
                        </div>
                         <div class="param-grid">
                            <div class="param-item">
                                <label>Max tokens</label>
                                <input type="text" class="custom-input" value="1024">
                            </div>
                            <div class="param-item">
                                <label>Max Tool Loops</label>
                                <input type="text" class="custom-input" value="3">
                            </div>
                        </div>
                    </div>
                    
                    <details>
                        <summary>Advanced Params</summary>
                        <div class="advanced-params-content">
                            <div class="param-item">
                                <label>Top K</label>
                                <input type="range" min="0" max="50" step="1" value="40">
                            </div>
                            <div class="param-item">
                                <label>Stop sequence</label>
                                <input type="text" class="custom-input" placeholder="e.g., ###">
                            </div>
                            <div class="param-grid">
                                <div class="param-item">
                                    <label>Frequency penalty</label>
                                    <input type="range" min="0" max="2" step="0.01" value="0">
                                </div>
                                 <div class="param-item">
                                    <label>Presence penalty</label>
                                    <input type="range" min="0" max="2" step="0.01" value="0">
                                </div>
                            </div>
                        </div>
                    </details>
                </div>

                <div class="config-section">
                     <div class="section-header">
                        <h3>Capabilities</h3>
                        <button class="btn btn-icon"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    </div>
                </div>

                <div class="config-section">
                     <div class="section-header">
                        <h3>Data Sources</h3>
                        <button class="btn btn-icon"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    </div>
                </div>
                <div class="config-section">
                     <div class="section-header">
                        <h3>Files</h3>
                        <button class="btn btn-icon"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    </div>
                </div>
            </aside>

        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Dropdown pour le modèle
        const dropdown = document.getElementById('model-dropdown');
        if (dropdown) {
            const button = dropdown.querySelector('.custom-dropdown-button');
            const options = dropdown.querySelectorAll('.custom-dropdown-option');
            const selectedDisplay = document.getElementById('selected-model');

            button.addEventListener('click', () => {
                dropdown.classList.toggle('open');
            });

            options.forEach(option => {
                option.addEventListener('click', () => {
                    selectedDisplay.textContent = option.dataset.value;
                    options.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    dropdown.classList.remove('open');
                });
            });

            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('open');
                }
            });
        }
        // Toggle editable description
        const descText = document.getElementById('agent-description-text');
        const descInput = document.getElementById('agent-description-input');
        if (descText && descInput) {
            descText.addEventListener('click', () => {
                descText.style.display = 'none';
                descInput.style.display = 'block';
                descInput.focus();
            });
            descInput.addEventListener('blur', () => {
                const val = descInput.value.trim();
                descText.textContent = val || descInput.placeholder;
                descInput.style.display = 'none';
                descText.style.display = 'block';
            });
        }
    });
</script>
    <!-- Fullscreen CodeMirror Modal -->
    <div class="editor-modal" id="codemirror-modal" style="display:none;">
        <div class="modal-content">
            <div class="editor-header">
                <h2 class="editor-title">Instructions Editor</h2>
                <div class="editor-header-actions">
                     <div class="template-toggle">
                        <span class="toggle-label">Custom Template</span>
                        <label class="switch">
                            <input type="checkbox" id="custom-template-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="editor-container" id="codemirror-editor-container">
                <!-- CodeMirror is initialized here -->
            </div>
            <button class="magic-prompt-footer-btn" id="magic-prompt-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.75 2.75a.75.75 0 0 1 1.5 0v1.5a.75.75 0 0 1-1.5 0v-1.5Zm-6.03 2.22a.75.75 0 0 1 1.06 0l1.06 1.06a.75.75 0 1 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm8.31 1.06a.75.75 0 0 1 1.06-1.06l1.06 1.06a.75.75 0 1 1-1.06 1.06l-1.06-1.06ZM12 7.25a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 12 7.25Zm7.78 3.97a.75.75 0 0 1 0 1.06l-13.5 13.5a.75.75 0 0 1-1.06-1.06l13.5-13.5a.75.75 0 0 1 1.06 0ZM4.25 17.75a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5h-1.5Zm2.03-6.03a.75.75 0 0 1 0-1.06l1.06-1.06a.75.75 0 1 1 1.06 1.06l-1.06 1.06a.75.75 0 0 1-1.06 0Z"/></svg>
                Magic Prompt
            </button>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CodeMirror Logic ---
        const promptArea = document.getElementById('prompt-area');
        const fsBtn = document.querySelector('.btn-fullscreen');
        const modal = document.getElementById('codemirror-modal');
        const modalCloseBtn = document.getElementById('codemirror-modal-close');
        const editorContainer = document.getElementById('codemirror-editor-container');
        let cmInstance = null;

        // Détermine le mode de langage (JSON ou Markdown)
        function getLanguageMode(text) {
            const trimmedText = text.trim();
            if ((trimmedText.startsWith('{') && trimmedText.endsWith('}')) || (trimmedText.startsWith('[') && trimmedText.endsWith(']'))) {
                try {
                    JSON.parse(trimmedText);
                    // Mode standard pour JSON dans CodeMirror
                    return { name: "javascript", json: true };
                } catch (e) {
                    // Si ce n'est pas du JSON valide, on reste en Markdown
                    return 'markdown';
                }
            }
            // Par défaut, c'est du Markdown
            return 'markdown';
        }

        // Ouvre et initialise la modale CodeMirror
        function openModal() {
            if (!editorContainer) return;
            
            modal.style.display = 'flex';
            let content = promptArea.value;
            const initialMode = getLanguageMode(content);

            // Formate le JSON à l'ouverture pour une meilleure lisibilité
            if (typeof initialMode === 'object' && initialMode.json) {
                try {
                    content = JSON.stringify(JSON.parse(content), null, 2);
                } catch (e) {
                    // Ne fait rien si le JSON est invalide, l'affiche tel quel
                }
            }

            // Initialisation de base de CodeMirror
            cmInstance = CodeMirror(editorContainer, {
                value: content,
                mode: initialMode,
                theme: 'dracula',
                lineNumbers: true,
                lineWrapping: false,
                autofocus: true,
                viewportMargin: Infinity
            });

            // Met à jour le mode si le contenu change de type
            cmInstance.on('change', (instance) => {
                const currentContent = instance.getValue();
                const newMode = getLanguageMode(currentContent);
                const oldMode = instance.getOption('mode');

                const oldModeName = (typeof oldMode === 'string') ? oldMode : oldMode.name;
                const newModeName = (typeof newMode === 'string') ? newMode : newMode.name;

                if (oldModeName !== newModeName) {
                    instance.setOption('mode', newMode);
                }
            });

            // Rafraîchit l'éditeur pour s'assurer qu'il s'affiche correctement
            setTimeout(() => cmInstance.refresh(), 1);
        }

        // Ferme la modale et met à jour le textarea d'origine
        function closeModal() {
             if (cmInstance) {
                promptArea.value = cmInstance.getValue();
                editorContainer.innerHTML = ''; // Détruit l'instance
                cmInstance = null;
            }
            modal.style.display = 'none';
        }

        // Écouteurs d'événements
        if (fsBtn) {
            fsBtn.addEventListener('click', openModal);
        }

        if (modalCloseBtn) {
            modalCloseBtn.addEventListener('click', closeModal);
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display === 'flex') {
                closeModal();
            }
        });
    });
</script>
</body>
</html>

